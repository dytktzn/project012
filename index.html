<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Website Resmi Stasiun Meteorologi Sultan Babullah Ternate - BMKG">
    <title>Stamet Sultan Babullah Ternate - BMKG</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #fafafb;
        }
        .glass-nav {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }
        .weather-card {
            background: linear-gradient(135deg, #ffffff 0%, #f0f7ff 100%);
            transition: all 0.3s ease;
        }
        .weather-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px -15px rgba(0,0,0,0.05);
        }
        #map, #gempa-main-map { height: 450px; border-radius: 24px; z-index: 1; }
        
        /* Modal Map Height */
        #modal-map { height: 350px; width: 100%; border-radius: 16px; margin-top: 1rem; z-index: 10; }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        /* Dropdown Desktop */
        @media (min-width: 1024px) {
            .dropdown:hover .dropdown-menu { display: block; }
        }
        .dropdown-menu { display: none; }

        /* Utilities */
        .hidden-view { display: none !important; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Loading Spinner */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #3498db;
            width: 20px;
            height: 20px;
            -webkit-animation: spin 2s linear infinite; /* Safari */
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Pulse Animation for Quake */
        .quake-ring {
            border: 3px solid #ef4444;
            -webkit-border-radius: 30px;
            height: 30px;
            width: 30px;
            position: absolute;
            left: -15px;
            top: -15px;
            -webkit-animation: pulsate 1s ease-out;
            -webkit-animation-iteration-count: infinite; 
            opacity: 0.0
        }
        @keyframes pulsate {
            0% {-webkit-transform: scale(0.1, 0.1); opacity: 0.0;}
            50% {opacity: 1.0;}
            100% {-webkit-transform: scale(1.2, 1.2); opacity: 0.0;}
        }


        /*-- MARITIM VIEW --- */
        /* --- Style Tambahan untuk Cuaca Maritim --- */
        /* ... style lainnya ... */

        /* Dashboard Height Calculation */
        .maritim-dashboard-height {
            height: 700px; /* Tinggi fix untuk desktop agar rapi */
            max-height: 80vh;
        }
        
        @media (max-width: 1024px) {
            .maritim-dashboard-height {
                height: auto; /* Mobile auto height */
                max-height: none;
            }
            .maritim-list-mobile {
                max-height: 400px; /* Scroll area untuk list di mobile */
            }
        }

        /* Loader Animation */
        .maritim-loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            width: 30px; height: 30px;
            animation: spin 1s linear infinite;
        }
        
        /* List Item State */
        .location-item.active {
            background-color: #eff6ff;
            border-left-color: #2563eb;
            color: #1e40af;
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Navbar -->
    <nav class="fixed w-full z-[100] glass-nav border-b border-slate-200 shadow-sm">
        <div class="hidden lg:flex w-full bg-slate-900 text-white py-1.5 px-4 flex-wrap items-center justify-between border-b border-slate-700">
            <div class="flex items-center gap-3">
                <div class="flex items-center gap-1.5">
                    <div class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                    <span class="text-[8px] font-black uppercase opacity-80 tracking-tighter">Sync BMKG</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-[10px] font-bold text-blue-400">UTC</span>
                    <span id="bar-utc" class="font-mono text-sm font-bold text-white">00:00:00</span>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2"><span class="text-[10px] font-bold text-slate-400">WIB</span><span id="bar-wib" class="font-mono text-xs font-semibold">00:00:00</span></div>
                <div class="flex items-center gap-2"><span class="text-[10px] font-bold text-slate-400">WITA</span><span id="bar-wita" class="font-mono text-xs font-semibold">00:00:00</span></div>
                <div class="flex items-center gap-2 bg-slate-800 px-2 py-0.5 rounded border border-slate-700">
                    <span class="text-[10px] font-bold text-blue-400">WIT</span><span id="bar-wit" class="font-mono text-xs font-semibold">00:00:00</span>
                </div>
            </div>
        </div>

        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer" onclick="switchView('view-beranda')" aria-label="Beranda BMKG Ternate">
                <div class="w-12 h-12 rounded-full overflow-hidden bg-white flex items-center justify-center">
                  <img src="https://infobmkg.github.io/dist/images/logo.svg" alt="Logo BMKG" class="w-full h-full object-contain">
                </div>
                <div class="flex flex-col justify-center">
                    <h1 class="text-blue-900 leading-tight">
                        <span class="block lg:hidden text-base font-bold tracking-tight">
                            BMKG
                        </span>
                        <span class="hidden lg:block text-lg font-extrabold tracking-tight">
                            Badan Meteorologi Klimatologi dan Geofisika
                        </span>
                    </h1>

                    <h2 class="text-slate-500 font-bold">
                        <span class="block lg:hidden text-[10px] uppercase tracking-wide">
                            Stamet Sultan Babullah - Ternate
                        </span>
                        <span class="hidden lg:block text-[10px] uppercase tracking-widest">
                            Stasiun Meteorologi Sultan Babullah - Ternate
                        </span>
                    </h2>
                </div>
            </div>

            <div class="hidden lg:flex items-center gap-6 text-sm font-semibold text-slate-600">
                <button onclick="switchView('view-beranda')" class="hover:text-blue-600 transition-colors">Beranda</button>
                
                <div class="relative dropdown">
                    <button class="flex items-center gap-1 hover:text-blue-600 transition-colors py-2 focus:outline-none" aria-haspopup="true">
                        Profil <i data-lucide="chevron-down" class="w-4 h-4"></i>
                    </button>
                    <div class="absolute top-full left-0 w-48 bg-white border border-slate-100 shadow-xl rounded-2xl py-2 mt-0 dropdown-menu">
                        <button onclick="switchView('view-profil', 'sejarah')" class="block w-full text-left px-4 py-2 hover:bg-blue-50 hover:text-blue-600">Sejarah Stasiun</button>
                        <button onclick="switchView('view-profil', 'visi-misi')" class="block w-full text-left px-4 py-2 hover:bg-blue-50 hover:text-blue-600">Visi & Misi</button>
                        <button onclick="switchView('view-profil', 'struktur')" class="block w-full text-left px-4 py-2 hover:bg-blue-50 hover:text-blue-600">Struktur Organisasi</button>
                    </div>
                </div>

                <div class="relative dropdown">
                    <button class="flex items-center gap-1 hover:text-blue-600 transition-colors py-2 focus:outline-none" aria-haspopup="true">
                        Informasi <i data-lucide="chevron-down" class="w-4 h-4"></i>
                    </button>
                    <div class="absolute top-full left-0 w-52 bg-white border border-slate-100 shadow-xl rounded-2xl py-2 mt-0 dropdown-menu">
                        <button onclick="switchView('view-cuaca-publik')" class="block w-full text-left px-4 py-2 hover:bg-blue-50 hover:text-blue-600">Cuaca Publik</button>
                        <button onclick="switchView('view-cuaca-penerbangan')" class="block w-full text-left px-4 py-2 hover:bg-blue-50 hover:text-blue-600">Cuaca Penerbangan</button>
                        <button onclick="switchView('view-cuaca-maritim')" class="block w-full text-left px-4 py-2 hover:bg-blue-50 hover:text-blue-600">Cuaca Maritim</button>
                        <button onclick="switchView('view-peringatan')" class="block w-full text-left px-4 py-2 hover:bg-blue-50 hover:text-blue-600">Peringatan Dini</button>
                        <button onclick="switchView('view-gempa')" class="block w-full text-left px-4 py-2 hover:bg-blue-50 hover:text-blue-600">Gempa Bumi</button>
                        <button onclick="switchView('view-peta')" class="block w-full text-left px-4 py-2 hover:bg-blue-50 hover:text-blue-600">Peta Sebaran</button>
                    </div>
                </div>

                <div class="relative dropdown">
                    <button class="flex items-center gap-1 text-blue-700 hover:text-blue-900 transition-colors py-2 focus:outline-none" aria-haspopup="true">
                        <span class="flex items-center gap-1"><i data-lucide="shield-check" class="w-4 h-4"></i> Zona Integritas</span> 
                        <i data-lucide="chevron-down" class="w-4 h-4"></i>
                    </button>
                    <div class="absolute top-full left-0 w-64 bg-white border border-slate-100 shadow-xl rounded-2xl py-2 mt-0 dropdown-menu">
                        <button onclick="switchView('view-zi', 'komitmen')" class="block w-full text-left px-4 py-2 hover:bg-blue-50 hover:text-blue-600">1. Komitmen & Deklarasi</button>
                        <button onclick="switchView('view-zi', 'budaya')" class="block w-full text-left px-4 py-2 hover:bg-blue-50 hover:text-blue-600">2. Budaya Anti-Korupsi</button>
                        <button onclick="switchView('view-zi', 'transparansi')" class="block w-full text-left px-4 py-2 hover:bg-blue-50 hover:text-blue-600">3. Transparansi & Akuntabilitas</button>
                        <button onclick="switchView('view-zi', 'pelayanan')" class="block w-full text-left px-4 py-2 hover:bg-blue-50 hover:text-blue-600">4. Standar Pelayanan & IKM</button>
                        <button onclick="switchView('view-zi', 'pengaduan')" class="block w-full text-left px-4 py-2 hover:bg-blue-50 hover:text-blue-600">5. Saluran Pengaduan (WBS)</button>
                        <button onclick="switchView('view-zi', 'inovasi')" class="block w-full text-left px-4 py-2 hover:bg-blue-50 hover:text-blue-600">6. Inovasi Layanan</button>
                    </div>
                </div>

                <div class="relative dropdown">
                    <button class="flex items-center gap-1 hover:text-blue-600 transition-colors py-2 focus:outline-none" aria-haspopup="true">
                        Pelayanan <i data-lucide="chevron-down" class="w-4 h-4"></i>
                    </button>
                    <div class="absolute top-full left-0 w-52 bg-white border border-slate-100 shadow-xl rounded-2xl py-2 mt-0 dropdown-menu">
                        <button onclick="switchView('view-pelayanan')" class="block w-full text-left px-4 py-2 hover:bg-blue-50 hover:text-blue-600">Permintaan Data</button>
                        <button onclick="switchView('view-edukasi')" class="block w-full text-left px-4 py-2 hover:bg-blue-50 hover:text-blue-600">Kunjungan Edukasi</button>
                    </div>
                </div>

                <a href="#footer" class="bg-blue-600 text-white px-5 py-2.5 rounded-xl hover:bg-blue-700 transition-all shadow-md shadow-blue-200">Kontak Kami</a>
            </div>

            <button id="mobile-menu-btn" class="lg:hidden p-2 text-slate-600 hover:text-blue-600 focus:outline-none" aria-label="Buka Menu">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
        </div>

        <div id="mobile-menu" class="hidden lg:hidden bg-white border-t border-slate-100 px-6 py-4 space-y-2 shadow-lg h-screen overflow-y-auto pb-32">
            
            <button onclick="switchView('view-beranda'); toggleMobileMenu()" class="flex items-center gap-3 w-full text-left text-sm font-bold text-slate-700 hover:text-blue-600 py-3 border-b border-slate-50">
                <i data-lucide="home" class="w-4 h-4 text-slate-400"></i> Beranda
            </button>
            
            <div class="py-2 border-b border-slate-50">
                <button onclick="toggleSubmenu('submenu-zi', 'arrow-zi')" class="flex items-center justify-between w-full py-2 text-sm font-bold text-slate-700 group">
                    <span class="flex items-center gap-2 text-blue-600">
                        <i data-lucide="shield-check" class="w-4 h-4"></i> Zona Integritas
                    </span>
                    <i id="arrow-zi" data-lucide="chevron-down" class="w-4 h-4 text-slate-400 transition-transform duration-200"></i>
                </button>
                <div id="submenu-zi" class="hidden pl-6 mt-1 space-y-1 bg-blue-50/50 rounded-xl p-2 border border-blue-100/50">
                    <button onclick="switchView('view-zi', 'komitmen'); toggleMobileMenu()" class="block w-full text-left text-xs font-semibold text-slate-600 py-2 hover:text-blue-600">Komitmen & Deklarasi</button>
                    <button onclick="switchView('view-zi', 'budaya'); toggleMobileMenu()" class="block w-full text-left text-xs font-semibold text-slate-600 py-2 hover:text-blue-600">Budaya Anti-Korupsi</button>
                    <button onclick="switchView('view-zi', 'transparansi'); toggleMobileMenu()" class="block w-full text-left text-xs font-semibold text-slate-600 py-2 hover:text-blue-600">Transparansi Publik</button>
                    <button onclick="switchView('view-zi', 'pelayanan'); toggleMobileMenu()" class="block w-full text-left text-xs font-semibold text-slate-600 py-2 hover:text-blue-600">Standar Pelayanan / IKM</button>
                    <button onclick="switchView('view-zi', 'pengaduan'); toggleMobileMenu()" class="block w-full text-left text-xs font-semibold text-slate-600 py-2 hover:text-blue-600">Pengaduan (WBS)</button>
                    <button onclick="switchView('view-zi', 'inovasi'); toggleMobileMenu()" class="block w-full text-left text-xs font-semibold text-slate-600 py-2 hover:text-blue-600">Inovasi Layanan</button>
                </div>
            </div>

            <div class="py-2 border-b border-slate-50">
                <button onclick="toggleSubmenu('submenu-profil', 'arrow-profil')" class="flex items-center justify-between w-full py-2 text-sm font-bold text-slate-700 hover:text-blue-600">
                    <span class="flex items-center gap-3">
                        <i data-lucide="building-2" class="w-4 h-4 text-slate-400"></i> Profil
                    </span>
                    <i id="arrow-profil" data-lucide="chevron-down" class="w-4 h-4 text-slate-400 transition-transform duration-200"></i>
                </button>
                <div id="submenu-profil" class="hidden pl-9 mt-1 space-y-1">
                    <button onclick="switchView('view-profil', 'sejarah'); toggleMobileMenu()" class="block w-full text-left text-sm text-slate-500 py-2 hover:text-blue-600 border-l-2 border-slate-100 pl-3 hover:border-blue-500">Sejarah</button>
                    <button onclick="switchView('view-profil', 'visi-misi'); toggleMobileMenu()" class="block w-full text-left text-sm text-slate-500 py-2 hover:text-blue-600 border-l-2 border-slate-100 pl-3 hover:border-blue-500">Visi Misi</button>
                    <button onclick="switchView('view-profil', 'struktur'); toggleMobileMenu()" class="block w-full text-left text-sm text-slate-500 py-2 hover:text-blue-600 border-l-2 border-slate-100 pl-3 hover:border-blue-500">Struktur</button>
                </div>
            </div>

            <div class="py-2 border-b border-slate-50">
                <button onclick="toggleSubmenu('submenu-info', 'arrow-info')" class="flex items-center justify-between w-full py-2 text-sm font-bold text-slate-700 hover:text-blue-600">
                    <span class="flex items-center gap-3">
                        <i data-lucide="info" class="w-4 h-4 text-slate-400"></i> Informasi Publik
                    </span>
                    <i id="arrow-info" data-lucide="chevron-down" class="w-4 h-4 text-slate-400 transition-transform duration-200"></i>
                </button>
                <div id="submenu-info" class="hidden pl-9 mt-1 space-y-1">
                    <button onclick="switchView('view-cuaca-publik'); toggleMobileMenu()" class="block w-full text-left text-sm text-slate-500 py-2 hover:text-blue-600 border-l-2 border-slate-100 pl-3 hover:border-blue-500">Cuaca Publik</button>
                    <button onclick="switchView('view-cuaca-penerbangan'); toggleMobileMenu()" class="block w-full text-left text-sm text-slate-500 py-2 hover:text-blue-600 border-l-2 border-slate-100 pl-3 hover:border-blue-500">Penerbangan</button>
                    <button onclick="switchView('view-cuaca-maritim'); toggleMobileMenu()" class="block w-full text-left text-sm text-slate-500 py-2 hover:text-blue-600 border-l-2 border-slate-100 pl-3 hover:border-blue-500">Maritim</button>
                    <button onclick="switchView('view-peringatan'); toggleMobileMenu()" class="block w-full text-left text-sm text-slate-500 py-2 hover:text-blue-600 border-l-2 border-slate-100 pl-3 hover:border-blue-500">Peringatan Dini</button>
                    <button onclick="switchView('view-gempa'); toggleMobileMenu()" class="block w-full text-left text-sm text-slate-500 py-2 hover:text-blue-600 border-l-2 border-slate-100 pl-3 hover:border-blue-500">Gempa Bumi</button>
                    <button onclick="switchView('view-peta'); toggleMobileMenu()" class="block w-full text-left text-sm text-slate-500 py-2 hover:text-blue-600 border-l-2 border-slate-100 pl-3 hover:border-blue-500">Peta Sebaran</button>
                </div>
            </div>

            <div class="py-2 border-b border-slate-50">
                <button onclick="toggleSubmenu('submenu-layanan', 'arrow-layanan')" class="flex items-center justify-between w-full py-2 text-sm font-bold text-slate-700 hover:text-blue-600">
                    <span class="flex items-center gap-3">
                        <i data-lucide="users" class="w-4 h-4 text-slate-400"></i> Pelayanan
                    </span>
                    <i id="arrow-layanan" data-lucide="chevron-down" class="w-4 h-4 text-slate-400 transition-transform duration-200"></i>
                </button>
                <div id="submenu-layanan" class="hidden pl-9 mt-1 space-y-1">
                    <button onclick="switchView('view-pelayanan'); toggleMobileMenu()" class="block w-full text-left text-sm text-slate-500 py-2 hover:text-blue-600 border-l-2 border-slate-100 pl-3 hover:border-blue-500">Permintaan Data</button>
                    <button onclick="switchView('view-edukasi'); toggleMobileMenu()" class="block w-full text-left text-sm text-slate-500 py-2 hover:text-blue-600 border-l-2 border-slate-100 pl-3 hover:border-blue-500">Kunjungan Edukasi</button>
                </div>
            </div>

        </div>
    </nav>

    <!-- MAIN CONTENT CONTAINER -->
    <main>
        
        <!-- ==================== VIEW 1: BERANDA ==================== -->
        <div id="view-beranda" class="pt-[80px] fade-in">
            <!-- Hero / Main Weather Section -->
            <section id="dashboard" class="pt-[80px] pb-12 px-6">
                <div class="max-w-7xl mx-auto">
                    
                    <!-- Dynamic Search & Filter -->
                    <div class="mb-12 space-y-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
                            <div class="space-y-2">
                                <div class="inline-flex items-center gap-2 bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider">
                                    <i data-lucide="map-pin" class="w-3 h-3"></i> Pantauan Cuaca Maluku Utara
                                </div>
                                <h1 id="location-name" class="text-2xl md:text-5xl font-extrabold text-slate-900 tracking-tight">Memuat Lokasi...</h1>
                                <p id="current-date" class="text-slate-500 font-medium"></p>
                            </div>

                            <!-- Integrated Search Bar & Cascade Filter Dropdown -->
                            <div class="relative w-full md:w-[28rem] z-50">
                                <div class="flex items-center bg-white border border-slate-300 rounded-2xl px-2 py-2 shadow-sm focus-within:ring-2 focus-within:ring-blue-400 transition-all">
                                    <i data-lucide="search" class="w-5 h-5 text-slate-400 ml-2 mr-2 flex-shrink-0"></i>
                                    <input type="text" id="location-search" placeholder="Cari Kab/Kota, Kecamatan, atau Desa..." class="w-full bg-transparent outline-none text-sm font-medium py-1" aria-label="Cari Lokasi">
                                    
                                    <button id="toggle-filter-btn" class="p-2 bg-slate-50 text-slate-500 border border-slate-200 hover:text-blue-600 hover:bg-blue-50 rounded-xl transition-colors ml-2 focus:outline-none flex items-center gap-2 flex-shrink-0" title="Pencarian Lanjutan">
                                        <i data-lucide="sliders-horizontal" class="w-4 h-4"></i>
                                    </button>
                                </div>
                                
                                <div id="search-results" class="absolute top-full left-0 w-full mt-2 bg-white border border-slate-200 shadow-2xl rounded-2xl hidden overflow-y-auto max-h-80 custom-scrollbar z-50">
                                    <!-- Injected by JS -->
                                </div>

                                <div id="advanced-filter-menu" class="absolute top-full right-0 w-full sm:w-[320px] mt-2 bg-white border border-slate-200 shadow-2xl rounded-2xl hidden p-4 flex-col gap-3">
                                    <div class="text-sm font-bold text-slate-800 mb-1 flex items-center gap-2">
                                        <i data-lucide="filter" class="w-4 h-4 text-blue-500"></i> Pilih Lokasi Spesifik
                                    </div>
                                    <label for="sel-prov" class="sr-only">Provinsi</label>
                                    <select id="sel-prov" onchange="handleProvChange()" class="w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-400 outline-none"><option value="">Provinsi</option></select>
                                    <label for="sel-kab" class="sr-only">Kabupaten/Kota</label>
                                    <select id="sel-kab" onchange="handleKabChange()" class="w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-400 outline-none" disabled><option value="">Kabupaten/Kota</option></select>
                                    <label for="sel-kec" class="sr-only">Kecamatan</label>
                                    <select id="sel-kec" onchange="handleKecChange()" class="w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-400 outline-none" disabled><option value="">Kecamatan</option></select>
                                    <label for="sel-desa" class="sr-only">Desa/Kelurahan</label>
                                    <select id="sel-desa" onchange="handleDesaChange()" class="w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-400 outline-none" disabled><option value="">Semua Desa/Kelurahan</option></select>
                                    <button id="btn-show-weather" onclick="updateWeatherFromSelect()" class="w-full mt-2 px-6 py-2.5 bg-blue-600 text-white rounded-xl text-sm font-bold hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-md shadow-blue-200" disabled>
                                        <i data-lucide="search" class="w-4 h-4"></i> Tampilkan Cuaca
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Current Weather Card -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2 p-8 md:p-12 rounded-[40px] weather-card border border-blue-50 shadow-md flex flex-col md:flex-row items-center justify-between gap-8 relative overflow-visible">
                            
                            <div class="absolute top-6 left-6 md:top-8 md:left-12 flex items-center gap-2 z-20">
                                <span class="bg-blue-600 text-white text-[10px] font-bold uppercase px-3 py-1 rounded-full tracking-wider shadow-sm shadow-blue-200">
                                    Saat Ini
                                </span>
                                
                                <div class="relative group cursor-help">
                                    <i data-lucide="info" class="w-4 h-4 text-slate-400 hover:text-blue-600 transition-colors"></i>
                                    
                                    <div class="absolute left-0 bottom-full mb-2 w-48 bg-slate-800 text-white text-xs rounded-lg p-3 shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform translate-y-2 group-hover:translate-y-0 z-30">
                                        <p class="font-bold mb-1 text-blue-200">Status Data:</p>
                                        <p id="update-timestamp">Memuat waktu...</p>
                                        <div class="absolute top-full left-1.5 -mt-1 border-4 border-transparent border-t-slate-800"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="text-center md:text-left space-y-4 mt-8 md:mt-0 w-full z-10">
                                <div id="main-temp" class="text-8xl font-black text-slate-900 leading-none">--Â°</div>
                                <div id="weather-desc" class="text-2xl font-semibold text-slate-700">Menghubungkan API...</div>
                                
                                <div class="grid grid-cols-2 lg:flex gap-4 lg:gap-6 justify-center md:justify-start pt-4">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-blue-500 shadow-sm"><i data-lucide="wind" class="w-5 h-5"></i></div>
                                        <div><p class="text-[10px] uppercase font-bold text-slate-500">Angin</p><p id="wind-speed" class="text-sm font-bold text-slate-800">-- km/j</p></div>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-blue-500 shadow-sm"><i data-lucide="droplets" class="w-5 h-5"></i></div>
                                        <div><p class="text-[10px] uppercase font-bold text-slate-500">Lembap</p><p id="humidity" class="text-sm font-bold text-slate-800">--%</p></div>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-blue-500 shadow-sm"><i data-lucide="cloud-rain" class="w-5 h-5"></i></div>
                                        <div><p class="text-[10px] uppercase font-bold text-slate-500">Hujan</p><p id="precipitation" class="text-sm font-bold text-slate-800">-- mm</p></div>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-blue-500 shadow-sm"><i data-lucide="eye" class="w-5 h-5"></i></div>
                                        <div><p class="text-[10px] uppercase font-bold text-slate-500">Jarak Pandang</p><p id="visibility" class="text-sm font-bold text-slate-800">--</p></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="weather-icon-container" class="relative hidden md:block z-10">
                                <div class="w-56 h-56 bg-blue-100/50 rounded-full blur-3xl absolute inset-0 animate-pulse"></div>
                                <img id="weather-icon" src="" alt="Ilustrasi Cuaca" class="relative w-44 h-44 object-contain drop-shadow-2xl">
                            </div>
                        </div>

                        <div class="space-y-4 bg-white p-6 rounded-[32px] shadow-sm border border-slate-200">
                            <h3 class="font-bold text-slate-900 flex items-center gap-2 mb-4"><i data-lucide="clock" class="w-5 h-5 text-blue-500"></i> Prakiraan Tiap 3 Jam</h3>
                            <div id="hourly-forecast" class="space-y-3 h-[280px] overflow-y-auto pr-2 custom-scrollbar">
                                <!-- Hourly items injected here -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Alerts Section -->
            <section id="peringatan-section" class="py-20 px-6 bg-slate-100">
                <div class="max-w-7xl mx-auto">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-16">
                        <div>
                            <h2 class="text-3xl font-extrabold mb-8 flex items-center gap-3 text-slate-900"><i data-lucide="alert-triangle" class="text-orange-500 w-8 h-8"></i> Peringatan Dini Cuaca Ekstrem</h2>
                            <div id="alert-list-cuaca" class="space-y-4"></div>
                        </div>
                        <div>
                            <h2 class="text-3xl font-extrabold mb-8 flex items-center gap-3 text-slate-900"><i data-lucide="alert-triangle" class="text-orange-500 w-8 h-8"></i> Peringatan Dini Tsunami</h2>
                            <div id="alert-list-tsunami" class="space-y-4"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Map Section -->
            <section id="peta-section" class="py-20 px-6">
                <div class="max-w-7xl mx-auto">
                    <div class="mb-10 flex flex-col md:flex-row md:items-center justify-between gap-4">
                        <div>
                            <h2 class="text-3xl font-extrabold text-slate-900">Peta Sebaran Cuaca Maluku Utara</h2>
                            <p class="text-slate-500 mt-2 font-medium">Titik lokasi stasiun dan prakiraan wilayah berbasis spasial.</p>
                        </div>
                        <div class="flex gap-2">
                            <span class="flex items-center gap-2 text-xs font-bold uppercase tracking-wider bg-white px-4 py-2 rounded-full border border-slate-200 shadow-sm">
                                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> Sistem Aktif
                            </span>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-[32px] shadow-md border border-slate-200 relative z-10">
                        <div id="map"></div>
                    </div>
                </div>
            </section>

            <!-- Flight Weather Section -->
            <section id="flight-weather-section" class="py-20 px-6 bg-slate-100">
                <div class="max-w-7xl mx-auto">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
                        <div class="w-full">
                            <div class="bg-white p-6 rounded-3xl shadow-xl shadow-slate-200/50 border border-white">
                                <div class="flex items-center justify-between mb-6 border-b border-slate-100 pb-4">
                                    <div class="flex items-center gap-2 text-slate-700">
                                        <i data-lucide="globe" class="w-5 h-5 text-blue-600"></i>
                                        <span class="font-bold text-xs md:text-sm tracking-wide uppercase">Referensi Waktu Indonesia</span>
                                    </div>
                                    <div class="flex items-center gap-1 text-[10px] md:text-xs text-green-600 bg-green-50 px-3 py-1 rounded-full border border-green-100">
                                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                        <span>Live NTP Sync</span>
                                    </div>
                                </div>
                                <div class="text-center mb-6 p-6 bg-slate-50 rounded-2xl border border-slate-100">
                                    <span class="bg-slate-800 text-white text-[10px] font-black px-4 py-1 rounded-full tracking-widest mb-3 inline-block uppercase">Universal Time Coordinated (UTC)</span>
                                    <div id="clock-utc" class="text-5xl md:text-6xl font-mono font-bold text-slate-800 tracking-tighter my-2">00:00:00</div>
                                    <div id="date-utc" class="text-slate-400 font-bold text-xs uppercase tracking-[0.2em]">---, -- --- ----</div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                    <div class="bg-slate-50/50 p-4 rounded-2xl border border-slate-100 text-center"><span class="text-[10px] font-black text-slate-400 tracking-widest uppercase">WIB</span><div id="clock-wib" class="text-xl font-mono font-bold text-slate-700">00:00:00</div><div id="date-wib" class="text-[9px] font-bold text-slate-400 uppercase">-- --- ----</div></div>
                                    <div class="bg-slate-50/50 p-4 rounded-2xl border border-slate-100 text-center"><span class="text-[10px] font-black text-slate-400 tracking-widest uppercase">WITA</span><div id="clock-wita" class="text-xl font-mono font-bold text-slate-700">00:00:00</div><div id="date-wita" class="text-[9px] font-bold text-slate-400 uppercase">-- --- ----</div></div>
                                    <div class="bg-blue-50 p-4 rounded-2xl border border-blue-100 text-center ring-2 ring-blue-500/5"><span class="text-[10px] font-black text-blue-600 tracking-widest uppercase">WIT (Ternate)</span><div id="clock-wit" class="text-xl font-mono font-bold text-blue-900">00:00:00</div><div id="date-wit" class="text-[9px] font-bold text-blue-500 uppercase">-- --- ----</div></div>
                                </div>
                            </div>
                        </div>
                        <div class="lg:sticky lg:top-32">
                            <div class="p-8 md:p-10 bg-gradient-to-br from-blue-600 to-indigo-900 rounded-[40px] text-white shadow-2xl shadow-blue-900/30 relative overflow-hidden">
                                <div class="absolute -top-10 -right-10 w-40 h-40 bg-white/5 rounded-full blur-3xl"></div>
                                <h2 class="text-2xl md:text-3xl font-bold mb-6 leading-tight">Informasi Operasional Penerbangan</h2>
                                <p class="opacity-80 leading-relaxed text-sm md:text-base mb-10">Stasiun Meteorologi Sultan Babullah Ternate menyediakan layanan data cuaca penerbangan terkini (<span class="font-mono bg-white/20 px-1 rounded">METAR</span> & <span class="font-mono bg-white/20 px-1 rounded">TAF</span>) untuk menjamin keselamatan navigasi udara di wilayah Maluku Utara.</p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="p-5 bg-white/10 rounded-3xl backdrop-blur-md border border-white/20 hover:bg-white/15 transition-all"><div class="flex items-center gap-3 mb-2"><i data-lucide="plane" class="w-6 h-6 text-blue-200"></i><p class="text-[10px] font-black uppercase opacity-60 tracking-widest">ICAO Code</p></div><p class="text-2xl font-mono font-bold tracking-tighter text-white">WAEE</p></div>
                                    <div class="p-5 bg-white/10 rounded-3xl backdrop-blur-md border border-white/20 hover:bg-white/15 transition-all"><div class="flex items-center gap-3 mb-2"><i data-lucide="activity" class="w-6 h-6 text-green-300"></i><p class="text-[10px] font-black uppercase opacity-60 tracking-widest">Service Status</p></div><p class="text-2xl font-bold text-green-300">Active</p></div>
                                    <a href="https://web-aviation.bmkg.go.id/maps/WAEE" target="_blank" rel="noopener noreferrer" class="w-full mt-4 md:mt-8 group flex items-center justify-between bg-white/10 hover:bg-white text-white hover:text-blue-900 p-4 rounded-2xl border border-white/20 transition-all duration-300 shadow-lg decoration-none cursor-pointer">
                                        <div class="flex items-center gap-3"><div class="p-2 bg-white/20 group-hover:bg-blue-100 rounded-lg transition-colors"><i data-lucide="external-link" class="w-5 h-5"></i></div><div class="text-left leading-tight"><p class="text-[10px] text-sm font-bold">Metar/Speci/TAF</p></div></div>
                                    </a>
                                    <a href="https://www.bmkg.go.id/cuaca/bandara/WAEE" target="_blank" rel="noopener noreferrer" class="w-full mt-8 group flex items-center justify-between bg-white/10 hover:bg-white text-white hover:text-blue-900 p-4 rounded-2xl border border-white/20 transition-all duration-300 shadow-lg decoration-none">
                                        <div class="flex items-center gap-3"><div class="p-2 bg-white/20 group-hover:bg-blue-100 rounded-lg transition-colors"><i data-lucide="external-link" class="w-5 h-5"></i></div><div class="text-left leading-tight"><p class="text-[10px] text-sm font-bold">Cuaca Bandara</p></div></div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- ==================== VIEW 2: PROFIL (Hidden by default) ==================== -->
        <div id="view-profil" class="pt-[80px] hidden-view fade-in">
            <!-- Header Profil -->
            <section class="pt-[80px] pb-10 px-6 bg-white border-b border-slate-100">
                <div class="max-w-7xl mx-auto text-center">
                    <span class="text-blue-600 font-bold uppercase tracking-widest text-xs mb-2 block">Tentang Kami</span>
                    <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 mb-4">Profil Stasiun</h1>
                    <p class="text-slate-500 max-w-2xl mx-auto text-lg">Mengenal lebih dekat Stasiun Meteorologi Sultan Babullah Ternate sebagai garda terdepan informasi cuaca di Maluku Utara.</p>
                </div>
            </section>

            <!-- 1. Sejarah (Timeline Style) -->
            <section id="sejarah" class="py-16 px-6">
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-2xl font-bold text-slate-900 mb-8 flex items-center gap-2">
                        <i data-lucide="history" class="text-blue-600"></i> Sejarah Stasiun
                    </h2>
                    <div class="relative border-l-2 border-blue-100 ml-3 space-y-12">
                        <div class="relative pl-8">
                            <span class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-blue-500 ring-4 ring-blue-100"></span>
                            <span class="text-sm font-bold text-blue-600 mb-1 block">Tahun 1970-an</span>
                            <h3 class="text-xl font-bold text-slate-800 mb-2">Awal Pendirian</h3>
                            <p class="text-slate-600 leading-relaxed">Stasiun Meteorologi Ternate mulai beroperasi untuk mendukung penerbangan perintis di wilayah Maluku Utara. Pada masa ini, pengamatan dilakukan secara manual dengan peralatan konvensional.</p>
                        </div>
                        <div class="relative pl-8">
                            <span class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-blue-500 ring-4 ring-blue-100"></span>
                            <span class="text-sm font-bold text-blue-600 mb-1 block">Tahun 2000-an</span>
                            <h3 class="text-xl font-bold text-slate-800 mb-2">Modernisasi Peralatan</h3>
                            <p class="text-slate-600 leading-relaxed">Seiring peningkatan status Bandara Sultan Babullah, stasiun dilengkapi dengan peralatan digital Automatic Weather Station (AWS) dan sistem komunikasi satelit untuk diseminasi data yang lebih cepat.</p>
                        </div>
                        <div class="relative pl-8">
                            <span class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-blue-500 ring-4 ring-blue-100"></span>
                            <span class="text-sm font-bold text-blue-600 mb-1 block">Masa Kini</span>
                            <h3 class="text-xl font-bold text-slate-800 mb-2">Pusat Informasi Cuaca Maluku Utara</h3>
                            <p class="text-slate-600 leading-relaxed">Saat ini, Stamet Sultan Babullah menjadi koordinator wilayah untuk informasi cuaca publik dan penerbangan di Provinsi Maluku Utara, didukung oleh sistem radar cuaca dan SDM yang kompeten.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 2. Visi Misi (Grid Cards) -->
            <section id="visi-misi" class="py-16 px-6 bg-slate-50">
                <div class="max-w-7xl mx-auto">
                    <div class="text-center mb-12">
                        <h2 class="text-2xl font-bold text-slate-900 mb-4">Visi & Misi</h2>
                        <div class="w-16 h-1 bg-blue-500 mx-auto rounded-full"></div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Visi -->
                        <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-100 hover:shadow-md transition-all">
                            <div class="w-12 h-12 bg-blue-100 text-blue-600 rounded-2xl flex items-center justify-center mb-6">
                                <i data-lucide="target" class="w-6 h-6"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-slate-900 mb-4">Visi</h3>
                            <p class="text-lg text-slate-600 font-medium italic">"Mewujudkan BMKG yang Handal, Tanggap dan Mampu dalam rangka mendukung Keselamatan Masyarakat dan Keberhasilan Pembangunan Nasional, serta berperan aktif di tingkat Internasional."</p>
                        </div>

                        <!-- Misi -->
                        <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-100 hover:shadow-md transition-all">
                            <div class="w-12 h-12 bg-green-100 text-green-600 rounded-2xl flex items-center justify-center mb-6">
                                <i data-lucide="compass" class="w-6 h-6"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-slate-900 mb-4">Misi</h3>
                            <ul class="space-y-4">
                                <li class="flex items-start gap-3">
                                    <i data-lucide="check-circle" class="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"></i>
                                    <span class="text-slate-600">Mengamati dan memahami fenomena meteorologi, klimatologi, kualitas udara dan geofisika.</span>
                                </li>
                                <li class="flex items-start gap-3">
                                    <i data-lucide="check-circle" class="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"></i>
                                    <span class="text-slate-600">Menyediakan data, informasi dan jasa MKG yang handal dan terpercaya.</span>
                                </li>
                                <li class="flex items-start gap-3">
                                    <i data-lucide="check-circle" class="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"></i>
                                    <span class="text-slate-600">Berpartisipasi aktif dalam kegiatan internasional.</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 3. Struktur Organisasi (Tree Diagram Concept) -->
            <section id="struktur" class="py-16 px-6">
                <div class="max-w-5xl mx-auto">
                    <h2 class="text-2xl font-bold text-slate-900 mb-8 text-center">Struktur Organisasi</h2>
                    
                    <div class="flex flex-col items-center space-y-8">
                        <!-- Kepala Stasiun -->
                        <div class="bg-slate-900 text-white p-6 rounded-2xl w-64 text-center shadow-lg relative">
                            <div class="w-16 h-16 bg-slate-700 rounded-full mx-auto mb-3 flex items-center justify-center border-4 border-slate-600">
                                <i data-lucide="user" class="w-8 h-8"></i>
                            </div>
                            <h4 class="font-bold text-lg">Kepala Stasiun</h4>
                            <p class="text-slate-400 text-xs uppercase tracking-widest mt-1">Pimpinan</p>
                            <!-- Line connector -->
                            <div class="absolute -bottom-8 left-1/2 w-0.5 h-8 bg-slate-300 transform -translate-x-1/2"></div>
                        </div>

                        <!-- Tata Usaha -->
                        <div class="bg-white border border-slate-200 p-4 rounded-xl w-48 text-center shadow-sm relative">
                            <h4 class="font-bold text-slate-800">Tata Usaha</h4>
                            <!-- Line connector up -->
                            <div class="absolute -top-8 left-1/2 w-0.5 h-8 bg-slate-300 transform -translate-x-1/2"></div>
                            <!-- Line connector down -->
                            <div class="absolute -bottom-8 left-1/2 w-0.5 h-8 bg-slate-300 transform -translate-x-1/2"></div>
                        </div>

                        <!-- Kelompok Jabatan -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full relative">
                            <!-- Horizontal Line for Desktop -->
                            <div class="hidden md:block absolute -top-8 left-[16%] right-[16%] h-0.5 bg-slate-300"></div>

                            <!-- Observasi -->
                            <div class="bg-white border border-slate-200 p-6 rounded-2xl text-center shadow-sm relative">
                                <div class="absolute -top-8 left-1/2 w-0.5 h-8 bg-slate-300 transform -translate-x-1/2 md:block hidden"></div>
                                <div class="w-10 h-10 bg-blue-50 text-blue-600 rounded-full mx-auto mb-3 flex items-center justify-center">
                                    <i data-lucide="eye"></i>
                                </div>
                                <h4 class="font-bold text-slate-800">Observasi</h4>
                                <p class="text-sm text-slate-500 mt-2">Pengamatan & Data</p>
                            </div>

                            <!-- Data & Info -->
                            <div class="bg-white border border-slate-200 p-6 rounded-2xl text-center shadow-sm relative">
                                <div class="absolute -top-8 left-1/2 w-0.5 h-8 bg-slate-300 transform -translate-x-1/2 md:block hidden"></div>
                                <div class="w-10 h-10 bg-blue-50 text-blue-600 rounded-full mx-auto mb-3 flex items-center justify-center">
                                    <i data-lucide="bar-chart-2"></i>
                                </div>
                                <h4 class="font-bold text-slate-800">Data & Informasi</h4>
                                <p class="text-sm text-slate-500 mt-2">Prakiraan & Pelayanan</p>
                            </div>

                            <!-- Teknisi -->
                            <div class="bg-white border border-slate-200 p-6 rounded-2xl text-center shadow-sm relative">
                                <div class="absolute -top-8 left-1/2 w-0.5 h-8 bg-slate-300 transform -translate-x-1/2 md:block hidden"></div>
                                <div class="w-10 h-10 bg-blue-50 text-blue-600 rounded-full mx-auto mb-3 flex items-center justify-center">
                                    <i data-lucide="cpu"></i>
                                </div>
                                <h4 class="font-bold text-slate-800">Teknisi</h4>
                                <p class="text-sm text-slate-500 mt-2">Peralatan & Jaringan</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- ==================== VIEW 3: PELAYANAN DATA (PTSP) ==================== -->
        <div id="view-pelayanan" class="pt-[80px] hidden-view fade-in">
            <!-- Header Pelayanan -->
            <section class="pt-[80px] pb-10 px-6 bg-gradient-to-b from-blue-50 to-white border-b border-slate-100">
                <div class="max-w-7xl mx-auto text-center">
                    <span class="bg-blue-600 text-white font-bold uppercase tracking-widest text-[10px] px-3 py-1 rounded-full mb-4 inline-block">PTSP BMKG</span>
                    <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 mb-4">Pelayanan Data & Jasa MKG</h1>
                    <p class="text-slate-500 max-w-2xl mx-auto text-lg">Layanan terpadu satu pintu untuk permintaan data meteorologi, klimatologi, dan geofisika secara resmi untuk keperluan riset, proyek, maupun legal.</p>
                </div>
            </section>

            <!-- Alur Permintaan Data -->
            <section class="py-16 px-6">
                <div class="max-w-6xl mx-auto">
                    <div class="text-center mb-16">
                        <h2 class="text-2xl font-bold text-slate-900 mb-4">Alur Permintaan Data</h2>
                        <p class="text-slate-500">Prosedur standar operasional pelayanan data di Stasiun Meteorologi Sultan Babullah.</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-4 gap-8 relative">
                        <!-- Connecting Line (Desktop) -->
                        <div class="hidden md:block absolute top-12 left-[12%] right-[12%] h-1 bg-slate-100 -z-10"></div>

                        <!-- Step 1 -->
                        <div class="text-center group">
                            <div class="w-24 h-24 bg-white border-2 border-slate-100 rounded-full flex items-center justify-center mx-auto mb-6 shadow-sm group-hover:border-blue-400 group-hover:shadow-md transition-all relative z-10">
                                <i data-lucide="file-text" class="w-10 h-10 text-slate-400 group-hover:text-blue-600 transition-colors"></i>
                                <div class="absolute -top-2 -right-2 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold text-sm shadow-md">1</div>
                            </div>
                            <h3 class="font-bold text-slate-900 mb-2">Pengajuan Surat</h3>
                            <p class="text-sm text-slate-500 px-4">Pemohon mengirimkan surat permintaan data resmi ditujukan kepada Kepala Stasiun.</p>
                        </div>

                        <!-- Step 2 -->
                        <div class="text-center group">
                            <div class="w-24 h-24 bg-white border-2 border-slate-100 rounded-full flex items-center justify-center mx-auto mb-6 shadow-sm group-hover:border-blue-400 group-hover:shadow-md transition-all relative z-10">
                                <i data-lucide="user-check" class="w-10 h-10 text-slate-400 group-hover:text-blue-600 transition-colors"></i>
                                <div class="absolute -top-2 -right-2 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold text-sm shadow-md">2</div>
                            </div>
                            <h3 class="font-bold text-slate-900 mb-2">Verifikasi Admin</h3>
                            <p class="text-sm text-slate-500 px-4">Petugas memverifikasi ketersediaan data dan menghitung biaya (jika berlaku PNBP).</p>
                        </div>

                        <!-- Step 3 -->
                        <div class="text-center group">
                            <div class="w-24 h-24 bg-white border-2 border-slate-100 rounded-full flex items-center justify-center mx-auto mb-6 shadow-sm group-hover:border-blue-400 group-hover:shadow-md transition-all relative z-10">
                                <i data-lucide="credit-card" class="w-10 h-10 text-slate-400 group-hover:text-blue-600 transition-colors"></i>
                                <div class="absolute -top-2 -right-2 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold text-sm shadow-md">3</div>
                            </div>
                            <h3 class="font-bold text-slate-900 mb-2">Pembayaran (PNBP)</h3>
                            <p class="text-sm text-slate-500 px-4">Pemohon melakukan pembayaran sesuai tarif PNBP via Bank (Nol Rupiah untuk Mahasiswa/Peneliti).</p>
                        </div>

                        <!-- Step 4 -->
                        <div class="text-center group">
                            <div class="w-24 h-24 bg-white border-2 border-slate-100 rounded-full flex items-center justify-center mx-auto mb-6 shadow-sm group-hover:border-blue-400 group-hover:shadow-md transition-all relative z-10">
                                <i data-lucide="send" class="w-10 h-10 text-slate-400 group-hover:text-blue-600 transition-colors"></i>
                                <div class="absolute -top-2 -right-2 w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center font-bold text-sm shadow-md">4</div>
                            </div>
                            <h3 class="font-bold text-slate-900 mb-2">Pengiriman Data</h3>
                            <p class="text-sm text-slate-500 px-4">Data diproses dan dikirimkan melalui Email atau diambil langsung (Hardcopy).</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Katalog Layanan -->
            <section class="py-16 px-6 bg-slate-50">
                <div class="max-w-6xl mx-auto">
                    <div class="text-center mb-12">
                        <h2 class="text-2xl font-bold text-slate-900 mb-4">Katalog Layanan Data</h2>
                        <div class="w-16 h-1 bg-blue-500 mx-auto rounded-full"></div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Item 1 -->
                        <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-lg transition-all">
                            <div class="flex items-center justify-between mb-4">
                                <div class="p-2 bg-blue-50 text-blue-600 rounded-lg"><i data-lucide="cloud-rain" class="w-6 h-6"></i></div>
                                <span class="text-[10px] font-bold bg-green-100 text-green-700 px-2 py-1 rounded">Tersedia</span>
                            </div>
                            <h4 class="font-bold text-slate-900 text-lg mb-2">Data Curah Hujan</h4>
                            <p class="text-sm text-slate-500 mb-4">Data harian, bulanan, atau tahunan curah hujan (mm) untuk keperluan hidrologi dan konstruksi.</p>
                            <div class="pt-4 border-t border-slate-50 flex items-center justify-between">
                                <span class="text-xs font-bold text-slate-400">Format: Excel / PDF</span>
                                <span class="text-xs font-bold text-blue-600">Per Stasiun/Tahun</span>
                            </div>
                        </div>

                        <!-- Item 2 -->
                        <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-lg transition-all">
                            <div class="flex items-center justify-between mb-4">
                                <div class="p-2 bg-orange-50 text-orange-600 rounded-lg"><i data-lucide="thermometer" class="w-6 h-6"></i></div>
                                <span class="text-[10px] font-bold bg-green-100 text-green-700 px-2 py-1 rounded">Tersedia</span>
                            </div>
                            <h4 class="font-bold text-slate-900 text-lg mb-2">Data Suhu & Kelembapan</h4>
                            <p class="text-sm text-slate-500 mb-4">Data parameter suhu udara (maksimum, minimum, rata-rata) dan kelembapan udara.</p>
                            <div class="pt-4 border-t border-slate-50 flex items-center justify-between">
                                <span class="text-xs font-bold text-slate-400">Format: Excel / PDF</span>
                                <span class="text-xs font-bold text-blue-600">Per Stasiun/Tahun</span>
                            </div>
                        </div>

                        <!-- Item 3 -->
                        <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-lg transition-all">
                            <div class="flex items-center justify-between mb-4">
                                <div class="p-2 bg-indigo-50 text-indigo-600 rounded-lg"><i data-lucide="wind" class="w-6 h-6"></i></div>
                                <span class="text-[10px] font-bold bg-green-100 text-green-700 px-2 py-1 rounded">Tersedia</span>
                            </div>
                            <h4 class="font-bold text-slate-900 text-lg mb-2">Data Angin Permukaan</h4>
                            <p class="text-sm text-slate-500 mb-4">Data arah dan kecepatan angin (knot/kmj) untuk energi terbarukan atau bangunan tinggi.</p>
                            <div class="pt-4 border-t border-slate-50 flex items-center justify-between">
                                <span class="text-xs font-bold text-slate-400">Format: Excel / PDF</span>
                                <span class="text-xs font-bold text-blue-600">Per Stasiun/Tahun</span>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8 p-4 bg-blue-50 border border-blue-100 rounded-xl flex items-start gap-3">
                        <i data-lucide="info" class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"></i>
                        <div>
                            <p class="text-sm text-blue-800 font-bold mb-1">Tarif Nol Rupiah (Rp 0,-)</p>
                            <p class="text-xs text-blue-700 leading-relaxed">Berlaku khusus untuk kegiatan pendidikan, penelitian (Mahasiswa/Dosen), dan kegiatan sosial serta kebencanaan dengan melampirkan surat pengantar dari Instansi/Kampus.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Kontak Petugas -->
            <section class="py-16 px-6">
                <div class="max-w-4xl mx-auto bg-slate-900 rounded-3xl p-8 md:p-12 text-center text-white relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                    <div class="relative z-10">
                        <h2 class="text-2xl md:text-3xl font-bold mb-4">Butuh Data Cuaca? Hubungi Kami.</h2>
                        <p class="text-slate-300 mb-8">Tim PTSP kami siap membantu kebutuhan data Anda pada jam kerja (Senin - Jumat, 08.00 - 16.00 WIT).</p>
                        <div class="flex flex-col md:flex-row items-center justify-center gap-4">
                            <a href="mailto:stamet.ternate@bmkg.go.id" class="bg-white text-slate-900 px-6 py-3 rounded-xl font-bold hover:bg-slate-100 transition-colors flex items-center gap-2">
                                <i data-lucide="mail" class="w-4 h-4"></i> Kirim Email
                            </a>
                            <a href="https://wa.me/6281234567890" target="_blank" class="bg-green-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-green-500 transition-colors flex items-center gap-2">
                                <i data-lucide="message-circle" class="w-4 h-4"></i> Chat WhatsApp
                            </a>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- ==================== VIEW 4: KUNJUNGAN EDUKASI (NEW) ==================== -->
        <div id="view-edukasi" class="pt-[80px] hidden-view fade-in">
            <!-- Header Edukasi -->
            <section class="pt-[80px] pb-10 px-6 bg-gradient-to-b from-yellow-50 to-white border-b border-slate-100">
                <div class="max-w-7xl mx-auto text-center">
                    <span class="bg-yellow-500 text-white font-bold uppercase tracking-widest text-[10px] px-3 py-1 rounded-full mb-4 inline-block">Outing Class</span>
                    <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 mb-4">Belajar Cuaca Bersama BMKG</h1>
                    <p class="text-slate-500 max-w-2xl mx-auto text-lg">Mengenalkan dunia meteorologi sejak dini. Kami membuka kesempatan kunjungan belajar untuk Sekolah dan Universitas.</p>
                </div>
            </section>

            <!-- Info & Prosedur -->
            <section class="py-16 px-6">
                <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                    
                    <!-- Left: Illustration/Image Placeholder -->
                    <div class="relative">
                        <div class="absolute -top-10 -left-10 w-40 h-40 bg-yellow-200 rounded-full mix-blend-multiply filter blur-3xl opacity-50 animate-blob"></div>
                        <div class="absolute -bottom-10 -right-10 w-40 h-40 bg-pink-200 rounded-full mix-blend-multiply filter blur-3xl opacity-50 animate-blob animation-delay-2000"></div>
                        <div class="bg-white rounded-[40px] shadow-xl border border-slate-100 overflow-hidden relative z-10 p-6">
                           <div class="bg-slate-100 rounded-3xl h-64 w-full flex items-center justify-center text-slate-400">
                                <div class="text-center">
                                    <i data-lucide="smile" class="w-16 h-16 mx-auto mb-2 text-yellow-500"></i>
                                    <span class="font-bold">Foto Kegiatan Edukasi</span>
                                </div>
                           </div>
                           <div class="mt-6 space-y-4">
                               <div class="flex items-center gap-4 bg-yellow-50 p-4 rounded-2xl">
                                   <div class="w-12 h-12 bg-yellow-100 text-yellow-600 rounded-full flex items-center justify-center flex-shrink-0">
                                       <i data-lucide="users" class="w-6 h-6"></i>
                                   </div>
                                   <div>
                                       <h4 class="font-bold text-slate-900">Kapasitas Ideal</h4>
                                       <p class="text-sm text-slate-600">Maksimal 30 Orang / Sesi</p>
                                   </div>
                               </div>
                               <div class="flex items-center gap-4 bg-blue-50 p-4 rounded-2xl">
                                   <div class="w-12 h-12 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center flex-shrink-0">
                                       <i data-lucide="graduation-cap" class="w-6 h-6"></i>
                                   </div>
                                   <div>
                                       <h4 class="font-bold text-slate-900">Target Peserta</h4>
                                       <p class="text-sm text-slate-600">TK, SD, SMP, SMA, & Universitas</p>
                                   </div>
                               </div>
                           </div>
                        </div>
                    </div>

                    <!-- Right: Prosedur -->
                    <div>
                        <h2 class="text-3xl font-bold text-slate-900 mb-6">Prosedur Pengajuan Kunjungan</h2>
                        <div class="space-y-8 relative pl-6 border-l-2 border-slate-100">
                            <div class="relative">
                                <span class="absolute -left-[31px] top-0 w-6 h-6 bg-yellow-500 rounded-full text-white text-xs flex items-center justify-center font-bold ring-4 ring-white">1</span>
                                <h4 class="font-bold text-lg text-slate-900 mb-2">Kirim Surat Permohonan</h4>
                                <p class="text-slate-600">Ajukan surat resmi dari sekolah/kampus ditujukan kepada Kepala Stasiun Meteorologi Sultan Babullah Ternate. Kirimkan minimal <strong>H-7 sebelum tanggal kunjungan</strong>.</p>
                            </div>
                            <div class="relative">
                                <span class="absolute -left-[31px] top-0 w-6 h-6 bg-yellow-500 rounded-full text-white text-xs flex items-center justify-center font-bold ring-4 ring-white">2</span>
                                <h4 class="font-bold text-lg text-slate-900 mb-2">Cantumkan Detail Peserta</h4>
                                <p class="text-slate-600">Wajib mencantumkan jumlah peserta dan guru pendamping. Kami menyarankan maksimal 30 orang agar pembelajaran efektif.</p>
                            </div>
                            <div class="relative">
                                <span class="absolute -left-[31px] top-0 w-6 h-6 bg-green-500 rounded-full text-white text-xs flex items-center justify-center font-bold ring-4 ring-white">3</span>
                                <h4 class="font-bold text-lg text-slate-900 mb-2">Tunggu Konfirmasi</h4>
                                <p class="text-slate-600">Tim kami akan menghubungi Contact Person yang tertera di surat untuk konfirmasi jadwal dan teknis lapangan.</p>
                            </div>
                        </div>

                        <div class="mt-10 p-6 bg-slate-900 rounded-3xl text-white">
                            <h4 class="font-bold text-lg mb-4 flex items-center gap-2"><i data-lucide="calendar" class="text-yellow-400"></i> Jadwal Kunjungan Tersedia</h4>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <p class="text-slate-400 text-xs uppercase tracking-widest mb-1">Hari</p>
                                    <p class="font-bold text-lg">Selasa & Kamis</p>
                                </div>
                                <div>
                                    <p class="text-slate-400 text-xs uppercase tracking-widest mb-1">Waktu (WIT)</p>
                                    <p class="font-bold text-lg text-yellow-400">09.00 - 11.00</p>
                                </div>
                            </div>
                            <a href="https://wa.me/6281234567890" target="_blank" class="mt-6 w-full block text-center bg-white text-slate-900 py-3 rounded-xl font-bold hover:bg-yellow-400 transition-colors">
                                Hubungi Kami via WhatsApp
                            </a>
                        </div>
                    </div>

                </div>
            </section>
        </div>

        <!-- ==================== VIEW BARU: CUACA PUBLIK ==================== -->
        <div id="view-cuaca-publik" class="pt-[80px] hidden-view fade-in">
             <section class="pt-[80px] pb-10 px-6 bg-white border-b border-slate-100">
                <div class="max-w-4xl mx-auto text-center">
                    <span class="text-blue-600 font-bold uppercase tracking-widest text-xs mb-2 block">Layanan Informasi</span>
                    <h1 class="text-3xl md:text-5xl font-extrabold text-slate-900 mb-4">Prakiraan Cuaca Publik</h1>
                    <p class="text-slate-500 text-lg mb-8">Pantau kondisi cuaca terkini dan prakiraan hingga 3 hari ke depan di seluruh wilayah Indonesia.</p>

                    <!-- Search Box (Special Logic) -->
                    <div class="relative max-w-lg mx-auto">
                        <div class="flex items-center bg-white border-2 border-slate-200 rounded-2xl px-4 py-3 shadow-sm focus-within:border-blue-500 focus-within:ring-4 focus-within:ring-blue-100 transition-all">
                            <i data-lucide="search" class="w-6 h-6 text-slate-400 mr-3"></i>
                            <input type="text" id="public-location-search" placeholder="Cari Desa, Kecamatan, atau Kota..." class="w-full bg-transparent outline-none text-base font-medium text-slate-800" autocomplete="off">
                            <div id="search-loader" class="hidden ml-2"><div class="loader"></div></div>
                        </div>
                        <div id="public-search-results" class="absolute top-full left-0 w-full mt-2 bg-white border border-slate-200 shadow-2xl rounded-2xl hidden overflow-y-auto max-h-80 custom-scrollbar z-50 text-left">
                            <!-- Injected by JS -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Display Container -->
            <section id="public-weather-display" class="py-12 px-4 sm:px-6 lg:px-8 bg-slate-50 min-h-[500px] hidden">
                <div class="max-w-7xl mx-auto">
                    
                    <div class="flex flex-col md:flex-row items-center justify-between mb-8 gap-4">
                        <div class="text-center md:text-left">
                            <div class="inline-flex items-center gap-2 bg-white border border-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider shadow-sm mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
                                Lokasi Terpantau
                            </div>
                            <h2 id="pub-loc-name" class="text-3xl md:text-4xl font-black text-slate-800 tracking-tight">--</h2>
                            <p id="pub-loc-detail" class="text-slate-500 font-medium text-lg mt-1">--</p>
                        </div>
                        </div>

                    <div class="grid grid-cols-1 xl:grid-cols-12 gap-8 mb-12">
                        
                        <div class="xl:col-span-5 flex flex-col h-full">
                            <div class="relative overflow-hidden bg-gradient-to-br from-blue-600 via-blue-700 to-indigo-900 rounded-[3rem] shadow-2xl shadow-blue-900/20 p-8 h-full flex flex-col justify-between group"> <div class="absolute top-0 right-0 -mr-20 -mt-20 w-80 h-80 bg-white/10 rounded-full blur-3xl"></div>
                                <div class="absolute bottom-0 left-0 -ml-20 -mb-20 w-60 h-60 bg-blue-400/20 rounded-full blur-3xl"></div>

                                <div class="absolute top-6 right-6 z-50 group/tooltip">
                                    <button class="flex items-center justify-center w-8 h-8 rounded-full bg-white/10 backdrop-blur-md border border-white/20 text-blue-100 hover:bg-white hover:text-blue-600 transition-all shadow-sm cursor-help">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                                    </button>

                                    <div class="absolute right-0 mt-2 w-max max-w-[280px] opacity-0 invisible group-hover/tooltip:opacity-100 group-hover/tooltip:visible transition-all duration-300 transform translate-y-2 group-hover/tooltip:translate-y-0 pointer-events-none">
                                        <div class="absolute right-2 -top-1 w-3 h-3 bg-white rotate-45 border-l border-t border-blue-50"></div>
                                        
                                        <div id="pub-date" class="relative bg-white text-slate-600 text-xs py-2 px-3 rounded-xl shadow-xl border border-blue-100 flex items-center gap-2 whitespace-nowrap z-50">
                                            --
                                        </div>
                                    </div>
                                </div>
                                <div class="relative z-10 flex flex-col h-full gap-6 mt-4"> <div class="flex flex-col items-center text-center">
                                        <img id="pub-icon-img" src="" alt="Cuaca" class="w-32 h-32 mb-2 drop-shadow-lg filter brightness-110">
                                        <span id="pub-temp" class="text-7xl font-black text-white tracking-tighter drop-shadow-md">--Â°</span>
                                        <span id="pub-desc" class="text-2xl font-bold text-blue-100 mt-1 capitalize">--</span>
                                        <span class="text-blue-200 text-sm font-medium">Cuaca Saat Ini</span>
                                    </div>

                                    <div class="mt-auto">
                                        <div class="grid grid-cols-2 gap-3 bg-white/10 backdrop-blur-md border border-white/20 p-4 rounded-3xl">
                                            
                                            <div class="bg-gradient-to-b from-white/10 to-transparent p-3 rounded-2xl border border-white/5">
                                                <div class="flex items-center gap-1.5 text-blue-200 mb-1">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/></svg>
                                                    <span class="text-[10px] font-bold uppercase tracking-wider">Angin</span>
                                                </div>
                                                <div id="pub-wind" class="text-lg font-bold text-white leading-tight">--</div>
                                            </div>

                                            <div class="bg-gradient-to-b from-white/10 to-transparent p-3 rounded-2xl border border-white/5">
                                                <div class="flex items-center gap-1.5 text-blue-200 mb-1">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z"/></svg>
                                                    <span class="text-[10px] font-bold uppercase tracking-wider">Lembap</span>
                                                </div>
                                                <div id="pub-humid" class="text-lg font-bold text-white leading-tight">--</div>
                                            </div>

                                            <div class="bg-gradient-to-b from-white/10 to-transparent p-3 rounded-2xl border border-white/5">
                                                <div class="flex items-center gap-1.5 text-blue-200 mb-1">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
                                                    <span class="text-[10px] font-bold uppercase tracking-wider">Jarak</span>
                                                </div>
                                                <div id="pub-vis" class="text-lg font-bold text-white leading-tight">--</div>
                                            </div>

                                            <div class="bg-gradient-to-b from-white/10 to-transparent p-3 rounded-2xl border border-white/5">
                                                <div class="flex items-center gap-1.5 text-blue-200 mb-1">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/></svg>
                                                    <span class="text-[10px] font-bold uppercase tracking-wider">Hujan</span>
                                                </div>
                                                <div id="pub-rain" class="text-lg font-bold text-white leading-tight">--</div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="xl:col-span-7 flex flex-col">
                             <div id="pub-today-container" class="h-full"></div>
                        </div>

                    </div>

                    <div class="mt-8">
                        <h3 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                            <div class="bg-blue-100 p-1.5 rounded-lg text-blue-600">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
                            </div>
                            Prakiraan Berikutnya
                        </h3>
                        
                        <div id="pub-future-list" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        </div>
                    </div>

                </div>
            </section>
        </div>

        <!-- ==================== VIEW: GEMPA BUMI (NEW) ==================== -->
        <div id="view-gempa" class="pt-[80px] hidden-view fade-in">
             <section class="pt-[80px] pb-8 px-6 bg-white border-b border-slate-100">
                 <div class="max-w-7xl mx-auto text-center">
                    <span class="text-orange-600 font-bold uppercase tracking-widest text-xs mb-2 block">Earthquake Information</span>
                    <h1 class="text-3xl md:text-5xl font-extrabold text-slate-900 mb-4">Informasi Gempa Bumi</h1>
                    <p class="text-slate-500 text-lg">Pantauan terkini aktivitas seismik di seluruh wilayah Indonesia.</p>
                 </div>
             </section>

             <!-- HERO SECTION: GEMPA TERKINI -->
             <section class="py-10 px-6 bg-slate-50">
                <div class="max-w-7xl mx-auto">
                    <div class="bg-white rounded-[40px] shadow-lg border border-slate-200 overflow-hidden">
                        <div class="grid grid-cols-1 lg:grid-cols-3">
                            <!-- Left: Info Gempa Terkini -->
                            <div class="p-8 lg:p-12 flex flex-col justify-center relative bg-gradient-to-br from-slate-900 to-slate-800 text-white">
                                <div class="absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full blur-3xl -mr-16 -mt-16"></div>
                                <div class="relative z-10">
                                    <span class="inline-block bg-red-600 text-white text-[10px] font-black uppercase tracking-widest px-3 py-1 rounded-full mb-6 animate-pulse">Gempa Terkini</span>
                                    
                                    <div class="flex items-end gap-2 mb-2">
                                        <h2 id="gempa-mag" class="text-7xl font-black tracking-tighter text-white">--</h2>
                                        <span class="text-xl font-bold text-slate-400 mb-4">M</span>
                                    </div>
                                    
                                    <div class="space-y-6 mt-4">
                                        <div class="flex items-start gap-4">
                                            <div class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center flex-shrink-0"><i data-lucide="calendar" class="w-5 h-5 text-blue-300"></i></div>
                                            <div>
                                                <p class="text-xs text-slate-400 uppercase font-bold tracking-wider">Waktu Gempa</p>
                                                <p id="gempa-waktu" class="text-lg font-bold">--</p>
                                            </div>
                                        </div>
                                        <div class="flex items-start gap-4">
                                            <div class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center flex-shrink-0"><i data-lucide="map-pin" class="w-5 h-5 text-orange-300"></i></div>
                                            <div>
                                                <p class="text-xs text-slate-400 uppercase font-bold tracking-wider">Lokasi Pusat</p>
                                                <p id="gempa-lokasi" class="text-lg font-bold leading-tight">--</p>
                                                <p id="gempa-koordinat" class="text-sm text-slate-400 mt-1 font-mono">--</p>
                                            </div>
                                        </div>
                                        <div class="flex items-start gap-4">
                                            <div class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center flex-shrink-0"><i data-lucide="activity" class="w-5 h-5 text-green-300"></i></div>
                                            <div>
                                                <p class="text-xs text-slate-400 uppercase font-bold tracking-wider">Kedalaman</p>
                                                <p id="gempa-kedalaman" class="text-lg font-bold">--</p>
                                            </div>
                                        </div>
                                        <div class="mt-6 pt-6 border-t border-white/10">
                                            <p id="gempa-potensi" class="text-sm font-medium text-blue-200 italic">--</p>
                                            <p id="gempa-dirasakan" class="text-xs text-slate-400 mt-2 hidden">--</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Right: Map & Shakemap Tabs -->
                            <div class="lg:col-span-2 p-4 bg-slate-100 flex flex-col">
                                <div class="flex gap-2 mb-4 px-2">
                                    <button onclick="switchGempaTab('peta')" id="btn-tab-peta" class="px-4 py-2 bg-white text-slate-900 rounded-xl text-sm font-bold shadow-sm ring-1 ring-slate-200">Peta Lokasi</button>
                                    <button onclick="switchGempaTab('shakemap')" id="btn-tab-shakemap" class="px-4 py-2 bg-slate-200 text-slate-600 rounded-xl text-sm font-bold hover:bg-white hover:shadow-sm transition-all">Shakemap</button>
                                </div>
                                <div class="flex-1 bg-white rounded-3xl border border-slate-200 overflow-hidden relative">
                                    <!-- Map View -->
                                    <div id="gempa-main-map" class="w-full h-full min-h-[400px]"></div>
                                    <!-- Shakemap View -->
                                    <div id="gempa-shakemap-view" class="absolute inset-0 z-[50] bg-white hidden flex items-center justify-center p-4">
                                        <img id="gempa-shakemap-img" src="" alt="Shakemap" class="max-w-full max-h-full object-contain">
                                        <div id="shakemap-loader" class="absolute inset-0 flex items-center justify-center bg-white"><div class="loader"></div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
             </section>

             <!-- LIST SECTION -->
             <section class="py-12 px-6">
                 <div class="max-w-7xl mx-auto">
                     <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                         <!-- Gempa Dirasakan -->
                         <div>
                             <div class="flex items-center justify-between mb-6">
                                 <h3 class="text-2xl font-bold text-slate-900 flex items-center gap-2"><i data-lucide="rss" class="text-orange-500"></i> Gempa Dirasakan</h3>
                                 <span class="text-xs font-bold bg-orange-100 text-orange-700 px-2 py-1 rounded-md">15 Terakhir</span>
                             </div>
                             <div id="list-gempa-dirasakan" class="space-y-4">
                                 <div class="text-center py-8"><div class="loader mx-auto"></div></div>
                             </div>
                         </div>

                         <!-- Gempa M 5.0+ -->
                         <div>
                             <div class="flex items-center justify-between mb-6">
                                 <h3 class="text-2xl font-bold text-slate-900 flex items-center gap-2"><i data-lucide="activity" class="text-red-500"></i> Gempa M 5.0+</h3>
                                 <span class="text-xs font-bold bg-red-100 text-red-700 px-2 py-1 rounded-md">15 Terakhir</span>
                             </div>
                             <div id="list-gempa-besar" class="space-y-4">
                                 <div class="text-center py-8"><div class="loader mx-auto"></div></div>
                             </div>
                         </div>
                     </div>
                 </div>
             </section>
        </div>

        <!-- ==================== VIEW BLANK: CUACA PENERBANGAN ==================== -->
        <div id="view-cuaca-penerbangan" class="pt-[80px] hidden-view fade-in">
             <section class="pt-[80px] pb-20 px-6 text-center">
                 <div class="max-w-2xl mx-auto">
                     <img src="https://cdni.iconscout.com/illustration/premium/thumb/web-development-2974925-2477356.png" class="w-64 mx-auto mb-8 opacity-80" alt="Construction">
                     <h1 class="text-3xl font-bold text-slate-900 mb-4">Halaman Dalam Pengembangan</h1>
                     <p class="text-slate-500">Fitur informasi cuaca penerbangan yang lebih detail sedang kami siapkan untuk Anda.</p>
                 </div>
             </section>
        </div>

        <!-- ==================== VIEW: PERINGATAN DINI ==================== -->
        <div id="view-peringatan" class="pt-[80px] hidden-view fade-in">
             <section class="pt-[80px] pb-10 px-6 bg-white border-b border-slate-100">
                 <div class="max-w-7xl mx-auto text-center">
                    <span class="text-red-600 font-bold uppercase tracking-widest text-xs mb-2 block">Early Warning System</span>
                    <h1 class="text-3xl md:text-5xl font-extrabold text-slate-900 mb-4">Peringatan Dini Cuaca</h1>
                    <p class="text-slate-500 text-lg">Informasi resmi cuaca ekstrem terkini untuk seluruh wilayah Indonesia.</p>
                 </div>
             </section>

             <section class="py-12 px-6">
                 <div class="max-w-5xl mx-auto">
                     <div id="alert-page-list" class="space-y-6">
                         <!-- List Peringatan akan dirender disini oleh JS -->
                         <div class="text-center py-12">
                             <div class="loader mx-auto mb-4"></div>
                             <p class="text-slate-500">Memuat data peringatan...</p>
                         </div>
                     </div>
                 </div>
             </section>
        </div>



        <!-- ==================== VIEW BLANK: PETA SEBARAN ==================== -->
        <div id="view-peta" class="pt-[80px] hidden-view fade-in">
             <section class="pt-[80px] pb-20 px-6 text-center">
                 <div class="max-w-2xl mx-auto">
                     <img src="https://cdni.iconscout.com/illustration/premium/thumb/web-development-2974925-2477356.png" class="w-64 mx-auto mb-8 opacity-80" alt="Construction">
                     <h1 class="text-3xl font-bold text-slate-900 mb-4">Halaman Dalam Pengembangan</h1>
                     <p class="text-slate-500">Peta sebaran cuaca interaktif sedang kami siapkan untuk Anda.</p>
                 </div>
             </section>
        </div>

        <!-- ==================== VIEW : ZONA INTEGRASI ==================== -->
        <div id="view-zi" class="pt-[70px] view-section hidden fade-in">
            <section id="view-zi-section" class="pt-[70px] pt-24 pb-12 px-4 md:px-8 min-h-screen">
                <div class="max-w-7xl mx-auto">
                    
                    <div class="mb-8 text-center md:text-left">
                        <span class="inline-block py-1 px-3 rounded-full bg-blue-100 text-blue-700 text-xs font-bold tracking-wider mb-2">REFORMASI BIROKRASI</span>
                        <h2 class="text-3xl md:text-4xl font-extrabold text-slate-900 mb-2">Zona Integritas</h2>
                        <p class="text-slate-500 text-lg">Menuju Wilayah Bebas dari Korupsi (WBK) & Wilayah Birokrasi Bersih Melayani (WBBM)</p>
                    </div>

                    <div class="flex flex-col lg:flex-row gap-8">
                        
                        <div class="w-full lg:w-1/4">
                            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden sticky top-24">
                                <div class="p-4 bg-slate-50 border-b border-slate-100">
                                    <h3 class="font-bold text-slate-700">Menu Navigasi</h3>
                                </div>
                                <div class="flex flex-col p-2 space-y-1">
                                    <button id="btn-zi-komitmen" onclick="switchView('view-zi', 'komitmen')" class="zi-nav-btn w-full text-left px-4 py-3 rounded-xl font-semibold text-sm transition-all border-l-4 border-transparent hover:bg-slate-50 flex items-center gap-3 active-zi-btn">
                                        <i data-lucide="award" class="w-4 h-4"></i> Komitmen & Deklarasi
                                    </button>
                                    <button id="btn-zi-budaya" onclick="switchView('view-zi', 'budaya')" class="zi-nav-btn w-full text-left px-4 py-3 rounded-xl font-semibold text-sm transition-all border-l-4 border-transparent hover:bg-slate-50 flex items-center gap-3">
                                        <i data-lucide="shield-check" class="w-4 h-4"></i> Budaya Anti-Korupsi
                                    </button>
                                    <button id="btn-zi-transparansi" onclick="switchView('view-zi', 'transparansi')" class="zi-nav-btn w-full text-left px-4 py-3 rounded-xl font-semibold text-sm transition-all border-l-4 border-transparent hover:bg-slate-50 flex items-center gap-3">
                                        <i data-lucide="file-text" class="w-4 h-4"></i> Transparansi Publik
                                    </button>
                                    <button id="btn-zi-pelayanan" onclick="switchView('view-zi', 'pelayanan')" class="zi-nav-btn w-full text-left px-4 py-3 rounded-xl font-semibold text-sm transition-all border-l-4 border-transparent hover:bg-slate-50 flex items-center gap-3">
                                        <i data-lucide="smile" class="w-4 h-4"></i> Standar Layanan & IKM
                                    </button>
                                    <button id="btn-zi-pengaduan" onclick="switchView('view-zi', 'pengaduan')" class="zi-nav-btn w-full text-left px-4 py-3 rounded-xl font-semibold text-sm transition-all border-l-4 border-transparent hover:bg-slate-50 flex items-center gap-3">
                                        <i data-lucide="alert-triangle" class="w-4 h-4"></i> Saluran Pengaduan (WBS)
                                    </button>
                                    <button id="btn-zi-inovasi" onclick="switchView('view-zi', 'inovasi')" class="zi-nav-btn w-full text-left px-4 py-3 rounded-xl font-semibold text-sm transition-all border-l-4 border-transparent hover:bg-slate-50 flex items-center gap-3">
                                        <i data-lucide="zap" class="w-4 h-4"></i> Inovasi Unggulan
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="w-full lg:w-3/4 space-y-6">

                            <div id="zi-komitmen" class="zi-tab-content animate-fade-in">
                                <div class="relative h-64 rounded-2xl overflow-hidden mb-6 bg-slate-200 group">
                                    <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent z-10"></div>
                                    <img src="https://images.unsplash.com/photo-1577962917302-cd874c4e31d2?auto=format&fit=crop&q=80" alt="Pencanangan ZI" loading="lazy" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700">
                                    <div class="absolute bottom-6 left-6 z-20 text-white">
                                        <h3 class="text-2xl font-bold mb-1">Pencanangan Zona Integritas</h3>
                                        <p class="text-sm opacity-90">Komitmen Bersama Menuju WBK & WBBM</p>
                                    </div>
                                </div>

                                <div class="bg-white rounded-2xl p-6 border border-slate-200 shadow-sm mb-6">
                                    <h3 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                                        <i data-lucide="scroll-text" class="text-blue-600"></i> Pakta Integritas
                                    </h3>
                                    <p class="text-slate-600 mb-4 leading-relaxed">
                                        Seluruh pegawai Stasiun Meteorologi Sultan Babullah Ternate telah menandatangani dokumen Pakta Integritas sebagai janji untuk tidak melakukan praktek Korupsi, Kolusi, dan Nepotisme (KKN).
                                    </p>
                                    <div class="p-4 bg-blue-50 rounded-xl border border-blue-100 flex items-center gap-4">
                                        <div class="bg-blue-600 text-white p-3 rounded-lg"><i data-lucide="download"></i></div>
                                        <div>
                                            <h4 class="font-bold text-slate-800">Dokumen Pakta Integritas.pdf</h4>
                                            <p class="text-xs text-slate-500">Update Terakhir: Januari 2026</p>
                                        </div>
                                        <button class="ml-auto text-sm font-bold text-blue-600 hover:underline">Unduh</button>
                                    </div>
                                </div>

                                <div class="bg-gradient-to-r from-slate-900 to-slate-800 rounded-2xl p-8 text-white text-center shadow-lg relative overflow-hidden">
                                    <div class="absolute top-0 right-0 p-4 opacity-10"><i data-lucide="quote" class="w-20 h-20"></i></div>
                                    
                                    <h3 class="text-2xl font-serif font-bold mb-4 text-yellow-400">MAKLUMAT PELAYANAN</h3>
                                    <p class="text-lg italic mb-6 relative z-10">"Dengan ini, kami menyatakan sanggup menyelenggarakan pelayanan sesuai standar pelayanan yang telah ditetapkan. Apabila tidak menepati janji, kami siap menerima sanksi sesuai peraturan perundang-undangan yang berlaku."</p>
                                    <div class="flex justify-center gap-4 mb-6">
                                        <div class="w-12 h-1 bg-yellow-400 rounded-full"></div>
                                        <div class="w-2 h-1 bg-yellow-400 rounded-full"></div>
                                        <div class="w-2 h-1 bg-yellow-400 rounded-full"></div>
                                    </div>
                                    <div class="inline-block border-t border-slate-700 pt-4">
                                        <p class="font-bold uppercase tracking-widest text-xs text-slate-300">Kepala Stasiun Meteorologi Sultan Babullah</p>
                                        <p class="text-[10px] text-yellow-500/70 mt-1 font-mono tracking-tighter italic">Verified Digital Signature: BMKG-TERNATE-2026</p>
                                    </div>
                                </div>
                            </div>

                            <div id="zi-budaya" class="zi-tab-content hidden animate-fade-in">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    
                                    <div class="bg-white rounded-2xl border-2 border-red-50 p-6 shadow-sm overflow-hidden relative">
                                        <div class="absolute right-0 top-0 p-4 opacity-5"><i data-lucide="ban" class="w-20 h-20 text-red-600"></i></div>
                                        <h4 class="font-bold text-slate-800 mb-3 flex items-center gap-2">
                                            <i data-lucide="hand" class="text-red-500"></i> Komitmen Tanpa Gratifikasi
                                        </h4>
                                        <p class="text-sm text-slate-600 leading-relaxed mb-4">
                                            Seluruh jajaran Stasiun Meteorologi Sultan Babullah dilarang menerima pemberian dalam bentuk apapun (uang, barang, diskon, fasilitas) dari pengguna layanan.
                                        </p>
                                        <div class="bg-red-50 p-3 rounded-xl border border-red-100">
                                            <p class="text-[10px] font-bold text-red-700 uppercase mb-1">Capaian UPG 2025:</p>
                                            <p class="text-lg font-black text-red-600">0 Laporan Penerimaan</p>
                                        </div>
                                    </div>

                                    <div class="bg-white rounded-2xl border-2 border-blue-50 p-6 shadow-sm overflow-hidden relative">
                                        <div class="absolute right-0 top-0 p-4 opacity-5"><i data-lucide="megaphone" class="w-20 h-20 text-blue-600"></i></div>
                                        <h4 class="font-bold text-slate-800 mb-3 flex items-center gap-2">
                                            <i data-lucide="users" class="text-blue-500"></i> Sosialisasi Budaya Kerja
                                        </h4>
                                        <p class="text-sm text-slate-600 leading-relaxed mb-4">
                                            Kami aktif melakukan kampanye anti-korupsi baik secara internal kepada pegawai maupun kepada masyarakat luas melalui berbagai kanal.
                                        </p>
                                        <div class="grid grid-cols-3 gap-2">
                                            <div class="h-16 bg-slate-100 rounded-lg overflow-hidden border border-slate-200">
                                               <img src="https://placehold.co/100x50/9FB3DF/FFFFFF/?text=Kampanye+1&font=roboto" alt="Kampanye 1" class="w-full h-full object-cover">
                                            </div>
                                            <div class="h-16 bg-slate-100 rounded-lg overflow-hidden border border-slate-200">
                                               <img src="https://placehold.co/100x50/9EC6F3/FFFFFF/?text=Kampanye+2&font=roboto" alt="Kampanye 2" class="w-full h-full object-cover">
                                            </div>
                                            <div class="h-16 bg-slate-100 rounded-lg overflow-hidden border border-slate-200">
                                               <img src="https://placehold.co/100x50/BDDDE4/FFFFFF/?text=Kampanye+3&font=roboto" alt="Kampanye 3" class="w-full h-full object-cover">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-6 bg-slate-50 border border-slate-200 rounded-2xl p-6">
                                    <h4 class="font-bold text-slate-800 mb-2">Penanganan Benturan Kepentingan</h4>
                                    <p class="text-xs text-slate-500 mb-4 italic">Sesuai Keputusan Kepala BMKG Nomor: SK.11/OT.002/KB/XI/2021</p>
                                    <div class="flex items-center gap-4 text-sm text-slate-600">
                                         <div class="flex items-center gap-1"><i data-lucide="check-circle" class="w-4 h-4 text-green-500"></i> Identifikasi Risiko</div>
                                         <div class="flex items-center gap-1"><i data-lucide="check-circle" class="w-4 h-4 text-green-500"></i> SOP Pengendalian</div>
                                         <div class="flex items-center gap-1"><i data-lucide="check-circle" class="w-4 h-4 text-green-500"></i> Monitoring Berkala</div>
                                    </div>
                                </div>
                            </div>

                            <div id="zi-transparansi" class="zi-tab-content hidden animate-fade-in">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 text-center">
                                    <div class="bg-white p-4 rounded-xl border border-slate-200">
                                        <p class="text-xs font-bold text-slate-400 uppercase">Total DIPA 2026</p>
                                        <p class="text-xl font-bold text-slate-800">Rp 4.2 Miliar</p>
                                    </div>
                                    <div class="bg-white p-4 rounded-xl border border-slate-200">
                                        <p class="text-xs font-bold text-slate-400 uppercase">Realisasi Anggaran</p>
                                        <p class="text-xl font-bold text-green-600">12.5% <span class="text-xs text-slate-400 font-normal">( s.d Feb )</span></p>
                                    </div>
                                    <div class="bg-white p-4 rounded-xl border border-slate-200">
                                        <p class="text-xs font-bold text-slate-400 uppercase">Opini BPK</p>
                                        <p class="text-xl font-bold text-blue-600">WTP</p>
                                    </div>
                                </div>

                                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                                    <div class="p-6 border-b border-slate-100 flex justify-between items-center">
                                        <div>
                                            <h3 class="text-xl font-bold text-slate-800">Akuntabilitas Kinerja & Keuangan</h3>
                                            <p class="text-slate-500 text-sm">Dokumen publik transparan periode 2025/2026.</p>
                                        </div>
                                        <i data-lucide="info" class="text-slate-300 w-5 h-5"></i>
                                    </div>
                                    <div class="divide-y divide-slate-100">
                                        <div class="p-4 flex items-center justify-between hover:bg-slate-50 transition-colors">
                                            <div class="flex items-center gap-4">
                                                <div class="w-10 h-10 rounded-lg bg-red-100 text-red-600 flex items-center justify-center font-bold text-xs">PDF</div>
                                                <div>
                                                    <h4 class="font-bold text-slate-800 text-sm">Laporan Kinerja (LKjIP) 2025</h4>
                                                    <p class="text-[10px] text-slate-500">Analisis capaian target kinerja tahunan.</p>
                                                </div>
                                            </div>
                                            <button class="p-2 text-slate-400 hover:text-blue-600"><i data-lucide="download-cloud" class="w-5 h-5"></i></button>
                                        </div>

                                        <div class="p-4 flex items-center justify-between hover:bg-slate-50 transition-colors">
                                            <div class="flex items-center gap-4">
                                                <div class="w-10 h-10 rounded-lg bg-green-100 text-green-600 flex items-center justify-center font-bold text-xs">XLS</div>
                                                <div>
                                                    <h4 class="font-bold text-slate-800 text-sm">Ringkasan Realisasi Anggaran 2026</h4>
                                                    <p class="text-[10px] text-slate-500">Pembaruan data berkala (Update: 14 Feb 2026).</p>
                                                </div>
                                            </div>
                                            <button class="p-2 text-slate-400 hover:text-blue-600"><i data-lucide="download-cloud" class="w-5 h-5"></i></button>
                                        </div>

                                        <div class="p-4 flex items-center justify-between hover:bg-slate-50 transition-colors">
                                            <div class="flex items-center gap-4">
                                                <div class="w-10 h-10 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-xs">PDF</div>
                                                <div>
                                                    <h4 class="font-bold text-slate-800 text-sm">Perjanjian Kinerja (PK) Tahun 2026</h4>
                                                    <p class="text-[10px] text-slate-500">Target kinerja tahun berjalan yang telah ditandatangani.</p>
                                                </div>
                                            </div>
                                            <button class="p-2 text-slate-400 hover:text-blue-600"><i data-lucide="download-cloud" class="w-5 h-5"></i></button>
                                        </div>

                                        <div class="p-4 flex items-center justify-between hover:bg-slate-50 transition-colors">
                                            <div class="flex items-center gap-4">
                                                <div class="w-10 h-10 rounded-lg bg-orange-100 text-orange-600 flex items-center justify-center font-bold text-xs">PDF</div>
                                                <div>
                                                    <h4 class="font-bold text-slate-800 text-sm">Daftar Isian Pelaksanaan Anggaran (DIPA) 2026</h4>
                                                    <p class="text-[10px] text-slate-500">Rincian alokasi anggaran belanja negara.</p>
                                                </div>
                                            </div>
                                            <button class="p-2 text-slate-400 hover:text-blue-600"><i data-lucide="download-cloud" class="w-5 h-5"></i></button>
                                        </div>

                                        <div class="p-4 flex items-center justify-between hover:bg-slate-50 transition-colors">
                                            <div class="flex items-center gap-4">
                                                <div class="w-10 h-10 rounded-lg bg-purple-100 text-purple-600 flex items-center justify-center font-bold text-xs">PDF</div>
                                                <div>
                                                    <h4 class="font-bold text-slate-800 text-sm">Rencana Strategis (RENSTRA) 2020-2024</h4>
                                                    <p class="text-[10px] text-slate-500">Visi, misi, dan arah kebijakan jangka panjang.</p>
                                                </div>
                                            </div>
                                            <button class="p-2 text-slate-400 hover:text-blue-600"><i data-lucide="download-cloud" class="w-5 h-5"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="zi-pelayanan" class="zi-tab-content hidden animate-fade-in">
                                <div class="mb-6">
                                    <h3 class="text-xl font-bold text-slate-800 mb-2">Indeks Kepuasan Masyarakat (IKM)</h3>
                                    <p class="text-sm text-slate-500">Hasil evaluasi berkala terhadap kualitas layanan Stasiun Meteorologi Sultan Babullah.</p>
                                </div>

                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                                    <div class="bg-blue-600 rounded-3xl p-6 text-white shadow-xl shadow-blue-100 relative overflow-hidden">
                                        <div class="absolute -right-4 -top-4 opacity-10 rotate-12"><i data-lucide="database" class="w-24 h-24"></i></div>
                                        <div class="flex items-center gap-2 mb-4">
                                            <span class="bg-white/20 px-3 py-1 rounded-full text-[10px] font-bold tracking-widest uppercase">Layanan Jasa & Data</span>
                                        </div>
                                        <p class="text-blue-100 text-xs mb-1">Khusus Pengguna Data (Pemohon Resmi)</p>
                                        <div class="flex items-end gap-2 mb-4">
                                            <span class="text-5xl font-black">3.92</span>
                                            <span class="text-lg font-medium opacity-80 mb-2">/ 4.00</span>
                                        </div>
                                        <div class="w-full bg-blue-900/30 rounded-full h-2.5 mb-4">
                                            <div class="bg-white h-2.5 rounded-full" style="width: 98%"></div>
                                        </div>
                                        <div class="space-y-2 border-t border-white/10 pt-4">
                                            <div class="flex justify-between text-[11px]">
                                                <span>Kesesuaian Prosedur</span>
                                                <span class="font-bold">Sangat Baik</span>
                                            </div>
                                            <div class="flex justify-between text-[11px]">
                                                <span>Kecepatan Layanan</span>
                                                <span class="font-bold">Sangat Baik</span>
                                            </div>
                                            <p class="text-[9px] opacity-60 italic mt-2">* Berdasarkan 9 Unsur Permenpan-RB No. 14/2017</p>
                                        </div>
                                    </div>

                                    <div class="bg-white rounded-3xl p-6 border-2 border-slate-100 shadow-sm relative overflow-hidden">
                                        <div class="absolute -right-4 -top-4 opacity-5 rotate-12"><i data-lucide="rss" class="w-24 h-24"></i></div>
                                        <div class="flex items-center gap-2 mb-4">
                                            <span class="bg-slate-100 text-slate-600 px-3 py-1 rounded-full text-[10px] font-bold tracking-widest uppercase">Layanan Informasi Publik</span>
                                        </div>
                                        <p class="text-slate-400 text-xs mb-1">Followers Medsos & Pengunjung Web</p>
                                        <div class="flex items-end gap-2 mb-4">
                                            <span class="text-5xl font-black text-slate-800">3.85</span>
                                            <span class="text-lg font-medium text-slate-400 mb-2">/ 4.00</span>
                                        </div>
                                        <div class="w-full bg-slate-100 rounded-full h-2.5 mb-4">
                                            <div class="bg-blue-500 h-2.5 rounded-full" style="width: 96%"></div>
                                        </div>
                                        <div class="space-y-2 border-t border-slate-50 pt-4 text-slate-600">
                                            <div class="flex justify-between text-[11px]">
                                                <span>Kemudahan Akses Info</span>
                                                <span class="font-bold">Baik</span>
                                            </div>
                                            <div class="flex justify-between text-[11px]">
                                                <span>Kemanfaatan Konten</span>
                                                <span class="font-bold">Sangat Baik</span>
                                            </div>
                                            <p class="text-[9px] text-slate-400 italic mt-2">* Hasil Poling Digital Website & Instagram</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-slate-900 rounded-2xl p-6 text-white flex flex-col md:flex-row items-center gap-6 mb-8">
                                    <div class="flex-1">
                                        <h4 class="font-bold text-lg mb-1">Bantu Kami Terus Berbenah</h4>
                                        <p class="text-slate-400 text-sm">Pilih jenis survei sesuai dengan interaksi yang Anda lakukan bersama kami.</p>
                                    </div>
                                    <div class="flex flex-wrap gap-3">
                                        <button class="bg-blue-600 hover:bg-blue-700 px-6 py-2.5 rounded-xl font-bold text-sm transition-all flex items-center gap-2">
                                            <i data-lucide="file-check-2" class="w-4 h-4"></i> Survei Layanan Data
                                        </button>
                                        <button class="bg-white/10 hover:bg-white/20 px-6 py-2.5 rounded-xl font-bold text-sm transition-all border border-white/10 flex items-center gap-2">
                                            <i data-lucide="instagram" class="w-4 h-4"></i> Survei Info Digital
                                        </button>
                                    </div>
                                </div>

                                <div class="space-y-4">
                                    <h3 class="font-bold text-slate-800 text-lg flex items-center gap-2">
                                        <i data-lucide="book-open" class="text-blue-600 w-5 h-5"></i> Standar Layanan & SOP
                                    </h3>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <details class="group bg-white rounded-xl border border-slate-200 overflow-hidden">
                                            <summary class="flex justify-between items-center font-medium cursor-pointer list-none p-4 bg-slate-50 group-open:bg-white transition-colors">
                                                <span class="flex items-center gap-3"><i data-lucide="cloud-sun" class="text-blue-500 w-5 h-5"></i> Informasi Cuaca Khusus</span>
                                                <span class="transition group-open:rotate-180"><i data-lucide="chevron-down" class="w-4 h-4"></i></span>
                                            </summary>
                                            <div class="text-slate-600 p-4 border-t border-slate-100 text-sm space-y-2">
                                                <p><strong>Persyaratan:</strong> Surat Permohonan Resmi / Scan Identitas.</p>
                                                <p><strong>Waktu:</strong> Maksimal 1 Jam setelah permohonan valid diterima.</p>
                                                <p><strong>Biaya:</strong> Rp 0,- (Gratis untuk Instansi/Bencana).</p>
                                            </div>
                                        </details>
                                        <details class="group bg-white rounded-xl border border-slate-200 overflow-hidden">
                                            <summary class="flex justify-between items-center font-medium cursor-pointer list-none p-4 bg-slate-50 group-open:bg-white transition-colors">
                                                <span class="flex items-center gap-3"><i data-lucide="graduation-cap" class="text-blue-500 w-5 h-5"></i> Edukasi Meteorologi</span>
                                                <span class="transition group-open:rotate-180"><i data-lucide="chevron-down" class="w-4 h-4"></i></span>
                                            </summary>
                                            <div class="text-slate-600 p-4 border-t border-slate-100 text-sm space-y-2">
                                                <p><strong>Persyaratan:</strong> Surat Pengantar Sekolah/Kampus.</p>
                                                <p><strong>Waktu:</strong> Sesuai Jadwal (Pemesanan Min. H-3).</p>
                                                <p><strong>Biaya:</strong> Gratis / Rp 0,-</p>
                                            </div>
                                        </details>
                                    </div>
                                </div>
                            </div>

                            <div id="zi-pengaduan" class="zi-tab-content hidden animate-fade-in">
                                <div class="bg-white border border-slate-200 rounded-2xl p-6 mb-6">
                                    <h4 class="font-bold text-slate-800 mb-4 flex items-center gap-2"><i data-lucide="route" class="text-blue-500 w-5 h-5"></i> Alur Penanganan Aduan</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-center">
                                        <div class="space-y-2">
                                            <div class="w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto font-bold text-xs">1</div>
                                            <p class="text-[10px] font-bold">Laporan Masuk</p>
                                        </div>
                                        <div class="space-y-2">
                                            <div class="w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto font-bold text-xs">2</div>
                                            <p class="text-[10px] font-bold">Verifikasi (1x24 jam)</p>
                                        </div>
                                        <div class="space-y-2">
                                            <div class="w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto font-bold text-xs">3</div>
                                            <p class="text-[10px] font-bold">Investigasi Tim UPG</p>
                                        </div>
                                        <div class="space-y-2">
                                            <div class="w-8 h-8 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto font-bold text-xs">4</div>
                                            <p class="text-[10px] font-bold">Penyelesaian</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-red-50 border border-red-100 rounded-2xl p-6 mb-6">
                                    <h3 class="text-red-700 font-bold text-lg mb-2 flex items-center gap-2"><i data-lucide="shield-alert"></i> Whistleblowing System (WBS)</h3>
                                    <p class="text-red-600/80 text-xs mb-4">
                                        Kami menjamin <strong>KERAHASIAAN IDENTITAS PELAPOR</strong>. Jika melihat pungli atau pelanggaran kode etik, segera laporkan melalui:
                                    </p>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <a href="https://lapor.go.id" target="_blank" class="flex items-center justify-center gap-2 bg-white border border-red-200 py-3 rounded-xl font-bold text-red-600 hover:bg-red-50 transition-all text-sm">
                                            <i data-lucide="external-link" class="w-4 h-4"></i> SP4N LAPOR!
                                        </a>
                                        <a href="https://wa.me/62811xxxxxx?text=Halo%20Admin%20Pengaduan%20Sultan%20Babullah..." class="flex items-center justify-center gap-2 bg-green-500 py-3 rounded-xl font-bold text-white hover:bg-green-600 transition-all text-sm">
                                            <i data-lucide="message-circle" class="w-4 h-4"></i> WhatsApp Pengaduan
                                        </a>
                                    </div>
                                </div>

                                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                                    <h3 class="font-bold text-slate-800 mb-4 text-sm uppercase tracking-wider">Formulir Pengaduan Cepat</h3>
                                    <form class="space-y-4">
                                        <div>
                                            <label class="block text-xs font-bold text-slate-700 mb-1">Topik Aduan</label>
                                            <select class="w-full rounded-lg border-slate-300 bg-slate-50 p-2.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                                                <option>Dugaan Pungli / Gratifikasi</option>
                                                <option>Pelayanan Tidak Sesuai SOP</option>
                                                <option>Sikap / Perilaku Petugas</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-xs font-bold text-slate-700 mb-1">Isi Laporan (Kronologi)</label>
                                            <textarea rows="4" class="w-full rounded-lg border-slate-300 bg-slate-50 p-3 text-sm focus:ring-2 focus:ring-blue-500 outline-none transition-all" placeholder="Jelaskan detail kejadian, waktu, dan pihak yang terlibat..."></textarea>
                                        </div>
                                        <button type="button" class="w-full bg-slate-900 text-white font-bold py-3 rounded-xl hover:bg-slate-800 transition-colors shadow-lg">Kirim Laporan (Anonim)</button>
                                    </form>
                                </div>
                            </div>

                            <div id="zi-inovasi" class="zi-tab-content hidden animate-fade-in">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="bg-white rounded-2xl border border-slate-200 overflow-hidden hover:shadow-xl transition-all group">
                                        <div class="h-32 bg-blue-50 flex items-center justify-center relative overflow-hidden">
                                            <div class="absolute inset-0 bg-blue-600 opacity-0 group-hover:opacity-10 transition-opacity"></div>
                                            <i data-lucide="smartphone" class="w-12 h-12 text-blue-500 group-hover:scale-110 transition-transform"></i>
                                        </div>
                                        <div class="p-6">
                                            <h4 class="font-bold text-slate-800 mb-1 group-hover:text-blue-600 transition-colors">Aplikasi E-Ticketing Data</h4>
                                            <span class="text-[10px] font-bold bg-green-100 text-green-700 px-2 py-0.5 rounded-full">Efisiensi 200%</span>
                                            <p class="text-sm text-slate-500 mt-3 leading-relaxed">Transformasi digital permohonan data meteorologi yang memangkas waktu tunggu dari 3 hari menjadi hanya 1 jam melalui validasi otomatis.</p>
                                        </div>
                                    </div>
                                    <div class="bg-white rounded-2xl border border-slate-200 overflow-hidden hover:shadow-xl transition-all group">
                                        <div class="h-32 bg-indigo-50 flex items-center justify-center relative overflow-hidden">
                                            <div class="absolute inset-0 bg-indigo-600 opacity-0 group-hover:opacity-10 transition-opacity"></div>
                                            <i data-lucide="monitor" class="w-12 h-12 text-indigo-500 group-hover:scale-110 transition-transform"></i>
                                        </div>
                                        <div class="p-6">
                                            <h4 class="font-bold text-slate-800 mb-1 group-hover:text-indigo-600 transition-colors">Display Cuaca Bandara (Real-time)</h4>
                                            <span class="text-[10px] font-bold bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full">Transparansi Publik</span>
                                            <p class="text-sm text-slate-500 mt-3 leading-relaxed">Integrasi data AWS (Automatic Weather Station) langsung ke layar publik bandara untuk mendukung keselamatan penerbangan dan kenyamanan penumpang.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                </div>
            </section>
        </div>


        <!-- ==================== VIEW: CUACA MARITIM ==================== -->
        <div id="view-cuaca-maritim" class="pt-[80px] hidden-view fade-in">
            
            <section class="pt-[80px] pb-8 px-6 bg-white border-b border-slate-100">
                <div class="max-w-7xl mx-auto text-center">
                   <span class="text-red-600 font-bold uppercase tracking-widest text-xs mb-2 block">Layanan Informasi</span>
                   <h1 class="text-3xl md:text-5xl font-extrabold text-slate-900 mb-4">Prakiraan Cuaca Maritim</h1>
                   <p class="text-slate-500 text-lg max-w-3xl mx-auto">Informasi resmi terkini mengenai kondisi cuaca pelabuhan dan perairan di wilayah Maluku Utara.</p>
                </div>
            </section>

            <section class="py-8 px-4 lg:px-6 bg-[#fafafb]">
                <div class="max-w-7xl mx-auto">
                    
                    <div class="flex flex-col lg:flex-row gap-6">
                        
                        <div class="w-full lg:w-[350px] flex-shrink-0 flex flex-col gap-4">
                            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-4 flex flex-col gap-4 maritim-dashboard-height">
                                
                                <div class="bg-slate-100 p-1 rounded-xl flex shrink-0">
                                    <button onclick="maritimApp.switchCategory('pelabuhan')" id="tab-pelabuhan" class="flex-1 py-2.5 rounded-lg text-sm font-bold text-blue-600 bg-white shadow-sm transition-all flex justify-center items-center gap-2">
                                        <i data-lucide="anchor" class="w-4 h-4"></i> Pelabuhan
                                    </button>
                                    <button onclick="maritimApp.switchCategory('perairan')" id="tab-perairan" class="flex-1 py-2.5 rounded-lg text-sm font-bold text-slate-500 hover:text-slate-700 transition-all flex justify-center items-center gap-2">
                                        <i data-lucide="waves" class="w-4 h-4"></i> Perairan
                                    </button>
                                </div>

                                <div class="relative shrink-0">
                                    <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></i>
                                    <input type="text" id="maritimSearch" onkeyup="maritimApp.filterList()" placeholder="Cari nama lokasi..." 
                                        class="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all">
                                </div>

                                <div class="relative overflow-hidden h-[50vh] lg:h-auto lg:flex-1">
                                    <div class="absolute inset-0 overflow-y-auto custom-scrollbar pr-1" id="maritimList">
                                        <div class="flex flex-col items-center justify-center h-40 text-slate-400 gap-2">
                                            <div class="maritim-loader"></div>
                                            <span class="text-xs">Mengambil data...</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="shrink-0 pt-2 border-t border-slate-100 text-center">
                                    <span class="text-[10px] text-slate-400 font-medium">Sumber: Maritim BMKG</span>
                                </div>
                            </div>
                        </div>

                        <div class="hidden lg:block flex-1 bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden maritim-dashboard-height relative">
                            <div class="h-14 border-b border-slate-100 flex items-center justify-between px-6 bg-white">
                                <div class="flex items-center gap-2">
                                    <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                                    <h3 id="desktopTitle" class="font-bold text-slate-800">Pilih Lokasi</h3>
                                </div>
                                <a id="desktopExternalLink" href="#" target="_blank" class="text-xs font-bold text-blue-600 bg-blue-50 px-3 py-1.5 rounded-full hover:bg-blue-100 transition-colors flex items-center gap-1.5">
                                    Buka Website Sumber <i data-lucide="external-link" class="w-3 h-3"></i>
                                </a>
                            </div>

                            <div class="relative w-full h-[calc(100%-56px)] bg-slate-50 group">
                                
                                <div id="desktopLoader" class="absolute inset-0 flex flex-col items-center justify-center bg-white z-20">
                                    <div class="maritim-loader mb-3"></div>
                                    <span class="text-sm font-medium text-slate-500">Memuat visualisasi...</span>
                                </div>

                                <div onclick="maritimApp.expandToModal()" 
                                     class="absolute inset-0 z-10 cursor-pointer bg-transparent hover:bg-black/5 transition-colors flex items-center justify-center group-hover:opacity-100"
                                     title="Klik untuk berinteraksi">
                                     
                                     <div class="opacity-0 group-hover:opacity-100 transition-opacity bg-black/70 text-white px-4 py-2 rounded-full text-sm font-bold flex items-center gap-2 transform translate-y-4 group-hover:translate-y-0 duration-300">
                                        <i data-lucide="maximize-2" class="w-4 h-4"></i> Klik untuk Mode Jelajah
                                     </div>
                                </div>

                                <iframe id="desktopIframe" class="w-full h-full border-none pointer-events-none" src="about:blank"></iframe>
                                
                                <div id="emptyState" class="absolute inset-0 flex flex-col items-center justify-center bg-slate-50 z-0 hidden">
                                    <i data-lucide="map" class="w-12 h-12 text-slate-300 mb-3"></i>
                                    <p class="text-slate-400 text-sm">Pilih lokasi di sebelah kiri untuk melihat detail.</p>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </section>
        </div>

        <div id="maritimBrowserModal" class="fixed inset-0 z-[300] hidden bg-slate-900 transition-opacity duration-300">
            <div class="absolute inset-2 md:inset-8 bg-white rounded-2xl shadow-2xl flex flex-col overflow-hidden ring-1 ring-white/20">
                
                <div class="h-14 border-b border-slate-100 flex items-center justify-between px-4 bg-slate-50 shrink-0">
                    <div class="flex items-center gap-3 overflow-hidden">
                        <div class="flex gap-1.5">
                            <div class="w-3 h-3 rounded-full bg-red-400"></div>
                            <div class="w-3 h-3 rounded-full bg-yellow-400"></div>
                            <div class="w-3 h-3 rounded-full bg-green-400"></div>
                        </div>
                        <div class="bg-white border border-slate-200 px-3 py-1.5 rounded-lg flex items-center gap-2 text-xs text-slate-600 font-mono shadow-sm ml-2 min-w-[200px] md:min-w-[400px]">
                            <i data-lucide="lock" class="w-3 h-3 text-green-600"></i>
                            <span id="modalUrlDisplay" class="truncate">maritim.bmkg.go.id/...</span>
                        </div>
                    </div>
                    <button onclick="maritimApp.closeModal()" class="p-2 hover:bg-slate-200 rounded-lg transition-colors text-slate-500" title="Tutup">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                
                <div class="flex-1 relative bg-white w-full h-full">
                    <div id="modalLoader" class="absolute inset-0 flex flex-col items-center justify-center bg-white z-10">
                        <div class="maritim-loader mb-3"></div>
                        <span class="text-xs text-slate-500">Memuat halaman penuh...</span>
                    </div>
                    <iframe id="modalIframe" class="w-full h-full border-none" src="about:blank" sandbox="allow-forms allow-scripts allow-same-origin"></iframe>
                </div>
            </div>
        </div>

    </main>

    <!-- ALERT DETAIL MODAL -->
    <div id="alert-modal" class="fixed inset-0 z-[200] hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <!-- Backdrop -->
        <div class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity" onclick="closeAlertModal()"></div>

        <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
                
                <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-3xl border border-slate-200">
                    
                    <!-- Header -->
                    <div class="bg-red-50 px-4 py-4 sm:px-6 flex justify-between items-start border-b border-red-100">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center text-red-600 flex-shrink-0">
                                <i data-lucide="alert-octagon" class="w-6 h-6"></i>
                            </div>
                            <h3 class="text-lg font-bold leading-6 text-red-900" id="modal-title">Detail Peringatan Cuaca</h3>
                        </div>
                        <button type="button" class="text-slate-400 hover:text-slate-600 focus:outline-none" onclick="closeAlertModal()">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    
                    <!-- Content -->
                    <div class="px-4 py-5 sm:p-6 max-h-[70vh] overflow-y-auto custom-scrollbar">
                        <div id="modal-content" class="space-y-6">
                            <!-- Injected by JS -->
                            <div class="text-center py-8"><div class="loader mx-auto"></div></div>
                        </div>
                        
                        <!-- Modal Map Container -->
                        <div id="modal-map-container" class="hidden mt-6">
                            <h4 class="font-bold text-slate-800 mb-2 flex items-center gap-2"><i data-lucide="map" class="w-4 h-4"></i> Area Terdampak</h4>
                            <div id="modal-map"></div>
                        </div>
                    </div>

                    <!-- Footer -->
                    <div class="bg-slate-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6 border-t border-slate-100">
                        <button type="button" class="mt-3 inline-flex w-full justify-center rounded-xl bg-white px-3 py-2 text-sm font-semibold text-slate-900 shadow-sm ring-1 ring-inset ring-slate-300 hover:bg-slate-50 sm:mt-0 sm:w-auto" onclick="closeAlertModal()">Tutup</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer id="footer" class="bg-white border-t border-slate-200 pt-16 pb-8 px-6">
        <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-16">
            <div class="space-y-6">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center text-white font-bold text-xs">
                        <img src="https://infobmkg.github.io/dist/images/logo.svg" alt="Logo BMKG" class="w-full h-full object-contain p-2">
                    </div>
                    <span class="text-xl font-extrabold text-blue-900">Stamet Ternate</span>
                </div>
                <p class="text-sm text-slate-500 leading-relaxed font-medium">
                    Cepat, Tepat, Akurat, Luas, dan Mudah Dipahami.<br>Melayani informasi cuaca untuk keselamatan masyarakat dan penerbangan Maluku Utara.
                </p>
            </div>
            <div>
                <h4 class="font-bold text-slate-900 mb-6 uppercase text-xs tracking-widest">Tautan Penting</h4>
                <ul class="space-y-3 text-sm text-slate-600 font-medium">
                    <li><a href="https://www.bmkg.go.id" target="_blank" class="hover:text-blue-600 transition-colors">BMKG Pusat</a></li>
                    <li><a href="#" class="hover:text-blue-600 transition-colors">Info Gempa Terkini</a></li>
                    <li><a href="#" class="hover:text-blue-600 transition-colors">Cuaca Maritim</a></li>
                </ul>
            </div>
            <div>
                <h4 class="font-bold text-slate-900 mb-6 uppercase text-xs tracking-widest">Alamat Kantor</h4>
                <p class="text-sm text-slate-600 font-medium leading-relaxed">
                    Jl. Bandara Sultan Babullah,<br>
                    Tarau, Ternate Utara,<br>
                    Kota Ternate, Maluku Utara 97728
                </p>
            </div>
            <div>
                <h4 class="font-bold text-slate-900 mb-6 uppercase text-xs tracking-widest">Media Sosial</h4>
                <div class="flex gap-4">
                    <a href="#" aria-label="Instagram" class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center text-slate-500 hover:bg-blue-600 hover:text-white transition-all"><i data-lucide="instagram"></i></a>
                    <a href="#" aria-label="X" class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center text-slate-500 hover:bg-black hover:text-white transition-all"><i data-lucide="x"></i></a>
                    <a href="#" aria-label="Facebook" class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center text-slate-500 hover:bg-blue-600 hover:text-white transition-all"><i data-lucide="facebook"></i></a>
                    <a href="#" aria-label="YouTube" class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center text-slate-500 hover:bg-red-600 hover:text-white transition-all"><i data-lucide="youtube"></i></a>
                </div>
            </div>
        </div>
        <div class="max-w-7xl mx-auto pt-8 border-t border-slate-200 text-center flex flex-col md:flex-row justify-between items-center gap-4">
            <p class="text-sm text-slate-500 font-medium">Â© 2026 Stasiun Meteorologi Sultan Babullah Ternate. All rights reserved.</p>
            <p class="text-xs text-slate-400">Sumber Data: Open Data API BMKG</p>
        </div>
    </footer>




    <!-- View Switcher & Core Script -->
    <script>
        const API_BASE = "https://api.bmkg.go.id/publik";
        const API_INTERNAL = "api";
        const META_PATH = "meta";
        const PROXY_BASE = "proxy/index.php";

        // --- FLAG LAZY LOAD ---
        let isGempaLoaded = false;
        let isAlertPageLoaded = false;
        // ----------------------

        let regionTree = [];
        let flattenedRegions = [];
        let map;
        const DEFAULT_LOCATION_ID = "82.71.03.1020"; 
        let currentParentContext = null; // Restore this variable for search logic

        // === VIEW CONTROLLER LOGIC ===
        function switchView(viewId, param = null) {
            // 1. CLEANUP MARITIM (Hapus iframe jika keluar dari menu maritim)
            if (viewId !== 'view-cuaca-maritim') {
                if (typeof maritimApp !== 'undefined' && maritimApp.unmount) {
                    maritimApp.unmount();
                }
            }

            // 2. LOGIKA GANTI HALAMAN (Hide/Show)
            document.querySelectorAll('main > div, main > section').forEach(el => {
                if (el.id && el.id.startsWith('view-')) {
                    el.classList.add('hidden-view');
                    el.classList.remove('fade-in');
                    el.classList.add('hidden'); 
                }
            });

            const target = document.getElementById(viewId);
            if (target) {
                target.classList.remove('hidden-view');
                target.classList.remove('hidden');
                target.classList.add('fade-in');
            }

            // ==========================================
            // 3. LAZY LOADING LOGIC (Refined)
            // ==========================================

            // A. LOGIC MARITIM
            if (viewId === 'view-cuaca-maritim') {
                if (typeof maritimApp !== 'undefined' && maritimApp.mount) {
                    setTimeout(() => maritimApp.mount(), 300); 
                }
            }

            // B. LOGIC GEMPA (Hanya load sekali seumur hidup sesi)
            if (viewId === 'view-gempa') {
                // Cek flag: Jika belum pernah diload, baru kita load
                if (!isGempaLoaded) {
                    console.log("Lazy Loading: Mengambil Data Gempa...");
                    initGempaPage(); // Fetch API & Init Peta Gempa
                    isGempaLoaded = true; // Tandai sudah diload
                } else {
                    // Jika sudah pernah diload, cukup refresh ukuran peta agar tidak error render
                    if (typeof gempaMainMap !== 'undefined' && gempaMainMap) {
                        setTimeout(() => { gempaMainMap.invalidateSize(); }, 300);
                    }
                }
            }

            // C. LOGIC PERINGATAN DINI DETAIL (Hanya load sekali)
            if (viewId === 'view-peringatan') {
                if (!isAlertPageLoaded) {
                    console.log("Lazy Loading: Mengambil Detail Peringatan...");
                    fetchAlertsPage(); // Fetch RSS Detail
                    isAlertPageLoaded = true; // Tandai sudah diload
                }
            }

            // ==========================================
            // 4. LOGIKA SCROLL & ZONA INTEGRITAS
            // ==========================================
            if (viewId === 'view-zi') {
                window.scrollTo(0, 0);
                if (!param) param = 'komitmen';
                document.querySelectorAll('.zi-tab-content').forEach(el => el.classList.add('hidden'));
                const tabTarget = document.getElementById(`zi-${param}`);
                if (tabTarget) tabTarget.classList.remove('hidden');
                
                document.querySelectorAll('.zi-nav-btn').forEach(btn => {
                    btn.classList.remove('bg-blue-50', 'text-blue-600', 'border-blue-600');
                    btn.classList.add('text-slate-600', 'border-transparent');
                });
                const btnTarget = document.getElementById(`btn-zi-${param}`);
                if (btnTarget) {
                    btnTarget.classList.remove('text-slate-600', 'border-transparent');
                    btnTarget.classList.add('bg-blue-50', 'text-blue-600', 'border-blue-600');
                }
                return;
            }
            
            if (param) {
                setTimeout(() => {
                    const el = document.getElementById(param);
                    if (el) {
                        const headerOffset = 100;
                        const elementPosition = el.getBoundingClientRect().top;
                        const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                        window.scrollTo({ top: offsetPosition, behavior: "smooth" });
                    }
                }, 100);
            } else {
                window.scrollTo({ top: 0, behavior: "smooth" });
            }
        }

        // Fungsi untuk Membuka/Tutup Sub-Menu Mobile
        function toggleSubmenu(targetMenuId, targetIconId) {
            // 1. Daftar Mapping: Pasangan ID Menu dan ID Icon Panahnya
            // Pastikan ID ini sesuai dengan yang ada di HTML kamu
            const menuGroups = [
                { menu: 'submenu-zi', icon: 'arrow-zi' },
                { menu: 'submenu-profil', icon: 'arrow-profil' },
                { menu: 'submenu-info', icon: 'arrow-info' },
                { menu: 'submenu-layanan', icon: 'arrow-layanan' }
            ];

            // 2. Loop untuk mengecek setiap grup menu
            menuGroups.forEach(group => {
                const elMenu = document.getElementById(group.menu);
                const elIcon = document.getElementById(group.icon);

                // Cek apakah elemen ada (untuk menghindari error jika ID salah)
                if (elMenu && elIcon) {
                    
                    // JIKA ini BUKAN menu yang sedang diklik...
                    if (group.menu !== targetMenuId) {
                        // ...maka TUTUP paksa menu tersebut
                        elMenu.classList.add('hidden');
                        elIcon.classList.remove('rotate-180'); // Reset panah
                    }
                }
            });

            // 3. Setelah yang lain ditutup, baru kita Toggle menu yang diklik target
            const targetMenu = document.getElementById(targetMenuId);
            const targetIcon = document.getElementById(targetIconId);

            if (targetMenu && targetIcon) {
                targetMenu.classList.toggle('hidden');

                // Atur rotasi panah target
                if (targetMenu.classList.contains('hidden')) {
                    targetIcon.classList.remove('rotate-180');
                } else {
                    targetIcon.classList.add('rotate-180');
                }
            }
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        window.onload = async () => {
            lucide.createIcons();
            initMobileMenuListener();
            initMap();       // Peta Home (Wajib)
            displayDate();   // Tanggal Home (Wajib)
            
            await loadRegionData(); // Search Bar Home (Wajib)
            
            fetchWeather(DEFAULT_LOCATION_ID); // Cuaca Home (Wajib)
            fetchAlerts();   // Running Text/Map Home (Wajib)
            
            initSearch();
            initPublicSearch();
            
            // HAPUS ATAU KOMENTARI BARIS INI:
            // fetchAlertsPage();  <-- Hapus ini (Dipindah ke Lazy Load)
            // initGempaPage();    <-- Hapus ini (Dipindah ke Lazy Load)
            
            // Inisialisasi Maritim App (Hanya render list menu, tidak load iframe)
            if(typeof maritimApp !== 'undefined') maritimApp.init(); 
        };

        function initMobileMenuListener() {
            document.getElementById('mobile-menu-btn').addEventListener('click', toggleMobileMenu);
        }

        // --- DASHBOARD SEARCH LOGIC (RESTORED) ---
        function initSearch() {
            const input = document.getElementById('location-search');
            const results = document.getElementById('search-results');
            const filterBtn = document.getElementById('toggle-filter-btn');
            const filterMenu = document.getElementById('advanced-filter-menu');

            if (!input || !results) return;

            filterBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                if (filterMenu.classList.contains('hidden')) {
                    filterMenu.classList.remove('hidden'); filterMenu.classList.add('flex'); results.classList.add('hidden');
                } else { filterMenu.classList.add('hidden'); filterMenu.classList.remove('flex'); }
            });
            filterMenu.addEventListener('click', (e) => e.stopPropagation());

            input.addEventListener('input', (e) => {
                filterMenu.classList.add('hidden'); filterMenu.classList.remove('flex');
                const query = e.target.value;
                if (currentParentContext) {
                    const prefix = currentParentContext.name + " >";
                    if (!query.toUpperCase().startsWith(prefix.toUpperCase())) currentParentContext = null;
                }
                let searchTerm = query;
                if (currentParentContext) searchTerm = query.substring((currentParentContext.name + " >").length).trim();
                searchTerm = searchTerm.toLowerCase();

                if(searchTerm.length < 2 && !currentParentContext) { results.classList.add('hidden'); return; }

                let filtered = [];
                if (currentParentContext) {
                    const childLevel = currentParentContext.id.split('.').length + 1;
                    filtered = flattenedRegions.filter(r => r.id.startsWith(currentParentContext.id + ".") && r.id.split('.').length === childLevel && r.name.toLowerCase().includes(searchTerm)).slice(0, 50);
                } else {
                    filtered = flattenedRegions.filter(r => r.name.toLowerCase().includes(searchTerm)).slice(0, 50);
                }
                renderSearchResults(filtered, results, input);
            });

            document.addEventListener('click', (e) => {
                if(!e.target.closest('.relative')) { results.classList.add('hidden'); filterMenu.classList.add('hidden'); filterMenu.classList.remove('flex'); }
            });
        }

        function renderSearchResults(data, resultsContainer, inputElement) {
            resultsContainer.innerHTML = '';
            if(data.length > 0) {
                resultsContainer.classList.remove('hidden');
                data.forEach(item => {
                    const level = item.id.split('.').length;
                    const isDesa = level === 4;
                    const div = document.createElement('div');
                    div.className = 'search-item px-5 py-3 border-b border-slate-100 last:border-none flex justify-between items-center transition-colors hover:bg-slate-50 cursor-pointer';
                    div.innerHTML = `<div class="pr-2"><p class="text-sm font-bold text-slate-800">${item.name}</p><p class="text-[10px] text-slate-500 uppercase tracking-wider mt-0.5">${item.path}</p></div><div class="flex items-center gap-2 flex-shrink-0"><span class="text-[9px] bg-slate-100 border border-slate-200 text-slate-600 px-2 py-1 rounded-md font-bold uppercase tracking-wider">${item.type}</span>${isDesa ? `<span class="w-6 h-6 rounded-md bg-green-100 text-green-600 flex items-center justify-center"><i data-lucide="check" class="w-4 h-4"></i></span>` : `<span class="w-6 h-6 rounded-md bg-blue-100 text-blue-600 flex items-center justify-center"><i data-lucide="chevron-right" class="w-4 h-4"></i></span>`}</div>`;
                    div.onclick = (e) => {
                        e.stopPropagation();
                        if (isDesa) {
                            inputElement.value = item.name; resultsContainer.classList.add('hidden'); currentParentContext = null; fetchWeather(item.id);
                        } else {
                            currentParentContext = item; inputElement.value = item.name + " > "; inputElement.focus();
                            const childLevel = level + 1;
                            const childrenData = flattenedRegions.filter(r => r.id.startsWith(item.id + ".") && r.id.split('.').length === childLevel).slice(0, 50);
                            renderSearchResults(childrenData, resultsContainer, inputElement);
                        }
                    };
                    resultsContainer.appendChild(div);
                });
                lucide.createIcons();
            } else { resultsContainer.classList.remove('hidden'); resultsContainer.innerHTML = `<div class="px-5 py-4 text-center text-sm text-slate-500 font-medium">Lokasi tidak ditemukan.</div>`; }
        }

        // --- PUBLIC WEATHER SEARCH LOGIC ---
        function initPublicSearch() {
            const input = document.getElementById('public-location-search');
            const resultsContainer = document.getElementById('public-search-results');
            const loader = document.getElementById('search-loader');
            let debounceTimer;

            if(!input) return;

            input.addEventListener('input', (e) => {
                clearTimeout(debounceTimer);
                const keyword = e.target.value;
                if (keyword.length < 3) { resultsContainer.classList.add('hidden'); return; }
                loader.classList.remove('hidden');
                debounceTimer = setTimeout(async () => {
                    try {
                        const searchUrl = `https://cuaca.bmkg.go.id/api/df/v1/adm/search?keyword=${keyword}`;
                        const proxyUrl = `${PROXY_BASE}?url=${encodeURIComponent(searchUrl)}`;
                        const res = await fetch(proxyUrl);
                        const data = await res.json();
                        renderPublicSearchResults(data);
                    } catch (err) { console.error("Search Error:", err); resultsContainer.classList.add('hidden'); } 
                    finally { loader.classList.add('hidden'); }
                }, 500);
            });
            document.addEventListener('click', (e) => { if (!input.contains(e.target) && !resultsContainer.contains(e.target)) resultsContainer.classList.add('hidden'); });
        }

        function renderPublicSearchResults(data) {
            const container = document.getElementById('public-search-results');
            container.innerHTML = ''; container.classList.remove('hidden');
            if (!data || data.length === 0) { container.innerHTML = '<div class="p-4 text-slate-500 text-sm">Lokasi tidak ditemukan.</div>'; return; }
            data.forEach(item => {
                const div = document.createElement('div');
                div.className = 'px-4 py-3 hover:bg-blue-50 cursor-pointer border-b border-slate-100 last:border-none transition-colors';
                div.innerHTML = `<p class="font-bold text-slate-800 text-sm">${item.desa}</p><p class="text-xs text-slate-500 mt-0.5">${item.kecamatan}, ${item.kotkab}, ${item.provinsi}</p>`;
                div.onclick = () => { document.getElementById('public-location-search').value = `${item.desa}, ${item.kotkab}`; container.classList.add('hidden'); fetchPublicWeatherDetail(item.adm4); };
                container.appendChild(div);
            });
        }

        // Helper: Memastikan format string menjadi UTC Date object yang valid
        // Mengubah "2026-02-16 17:00:00" menjadi "2026-02-16T17:00:00Z"
        function parseToUTC(dateString) {
            if (!dateString) return new Date(); // Fallback
            // Jika format sudah ISO (ada 'T' dan 'Z'), langsung parse
            if (dateString.includes('T') && dateString.endsWith('Z')) {
                return new Date(dateString);
            }
            // Jika format SQL (spasi, tanpa Z), kita format manual
            // Ganti spasi dengan 'T' dan tambahkan 'Z' di akhir untuk memaksa UTC
            const isoString = dateString.replace(' ', 'T') + 'Z';
            return new Date(isoString);
        }

        // Helper: Menerjemahkan Arah Angin
        function translateDirection(dir) {
            const map = {
                'N': 'Utara', 'NNE': 'Utara Timur Laut', 'NE': 'Timur Laut', 'ENE': 'Timur Timur Laut',
                'E': 'Timur', 'ESE': 'Timur Tenggara', 'SE': 'Tenggara', 'SSE': 'Selatan Tenggara',
                'S': 'Selatan', 'SSW': 'Selatan Barat Daya', 'SW': 'Barat Daya', 'WSW': 'Barat Barat Daya',
                'W': 'Barat', 'WNW': 'Barat Barat Laut', 'NW': 'Barat Laut', 'NNW': 'Utara Barat Laut',
                'VAR': 'Berubah-ubah'
            };
            return map[dir] || dir;
        }

        async function fetchPublicWeatherDetail(adm4) {
            const displaySection = document.getElementById('public-weather-display');
            const titleEl = document.getElementById('pub-loc-name');
            const detailEl = document.getElementById('pub-loc-detail');
            const dateEl = document.getElementById('pub-date'); 

            // RESET UI
            displaySection.classList.remove('hidden');
            titleEl.innerText = "Memuat Data...";
            detailEl.innerText = "Mengambil koordinat...";
            dateEl.innerText = "Menghubungkan ke satelit...";
            document.getElementById('pub-temp').innerText = "--Â°";
            document.getElementById('pub-desc').innerText = "--";

            try {
                // 1. FETCH DATA PRAKIRAAN
                const resForecast = await fetch(`https://api.bmkg.go.id/publik/prakiraan-cuaca?adm4=${adm4}`);
                if (!resForecast.ok) throw new Error("Forecast API Error");
                
                const jsonForecast = await resForecast.json();
                const data = jsonForecast.data[0];
                const weatherList = data.cuaca.flat();
                
                if (!weatherList.length) throw new Error("No weather data");

                const lat = parseFloat(data.lokasi.lat);
                const lon = parseFloat(data.lokasi.lon);
                const correctTimezone = jsonForecast.lokasi.timezone || 'Asia/Jakarta';

                titleEl.innerText = data.lokasi.desa;
                detailEl.innerText = `${data.lokasi.kecamatan}, ${data.lokasi.kotkab}, ${data.lokasi.provinsi}`;

                // 2. FETCH DATA REALTIME
                let currentData = weatherList[0]; 
                let isRealtime = false;
                let finalTime = currentData.local_datetime; 
                
                // REVISI: Reference Date String awal ambil dari Forecast (Format SQL: "YYYY-MM-DD HH:mm:ss")
                let referenceUtcString = currentData.utc_datetime; 

                try {
                    const realtimeUrl = `https://cuaca.bmkg.go.id/api/presentwx/coord?lat=${lat}&lon=${lon}`;
                    const resRealtime = await fetch(`${PROXY_BASE}?url=${encodeURIComponent(realtimeUrl)}`);
                    const jsonRealtime = await resRealtime.json();

                    if (jsonRealtime.status === 200 && jsonRealtime.data && jsonRealtime.data.cuaca) {
                        currentData = jsonRealtime.data.cuaca; 
                        isRealtime = true;
                        
                        // Update Reference Date dari Realtime API (Format ISO: "YYYY-MM-DDTHH:mm:ss.sssZ")
                        if (currentData.datetime) {
                            referenceUtcString = currentData.datetime;

                            const utcDate = new Date(currentData.datetime);
                            finalTime = utcDate.toLocaleString('sv-SE', {
                                timeZone: correctTimezone, 
                                year: 'numeric', month: '2-digit', day: '2-digit',
                                hour: '2-digit', minute: '2-digit', second: '2-digit',
                                hour12: false
                            }).replace(' ', ' ');
                        } else if (currentData.local_datetime) {
                            finalTime = currentData.local_datetime;
                        }
                    }
                } catch (err) {
                    console.warn("Realtime fetch failed, fallback to forecast.", err);
                }

                // 3. UPDATE UI KARTU UTAMA
                // 3. UPDATE UI KARTU UTAMA
                // Struktur Tooltip: Heading (Badge) -> Body (Waktu) -> Footer (Label)
                dateEl.innerHTML = `
                    <div class="flex flex-col items-start min-w-[140px] text-left">
                        <div class="w-full flex justify-between items-center border-b border-slate-100 pb-2 mb-2">
                            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Status</span>
                            <span class="bg-blue-50 text-blue-600 border border-blue-100 px-1.5 py-0.5 rounded text-[10px] font-bold">UPDATE</span>
                        </div>
                        
                        <div class="text-sm font-extrabold text-slate-700 leading-tight mb-1">
                            ${finalTime}
                        </div>
                        
                        <div class="text-[10px] font-medium text-slate-400">
                            (Waktu Setempat)
                        </div>
                    </div>
                `;
                document.getElementById('pub-temp').innerText = `${currentData.t}Â°`;
                document.getElementById('pub-desc').innerText = currentData.weather_desc || 'Berawan';
                document.getElementById('pub-wind').innerText = `${currentData.ws} km/j`;
                document.getElementById('pub-humid').innerText = `${currentData.hu}%`;
                document.getElementById('pub-vis').innerText = currentData.vs_text || '--';
                // --- TAMBAHKAN BARIS INI ---
                // Mengatur gambar ikon cuaca dari API
                const iconEl = document.getElementById('pub-icon-img');
                if (currentData.image) {
                    iconEl.src = currentData.image;
                    iconEl.classList.remove('hidden');
                } else {
                    // Fallback jika tidak ada gambar
                    iconEl.src = "https://api-apps.bmkg.go.id/storage/icon/cuaca/berawan-am.svg"; 
                }
                // ---------------------------
                
                const rainForecast = parseFloat(weatherList[0].tp) || 0;
                const rainRealtime = parseFloat(currentData.tp) || 0;
                const rainVal = (isRealtime && rainRealtime === 0) ? rainForecast : rainRealtime;
                document.getElementById('pub-rain').innerText = `${rainVal} mm`;

                // ---------------------------------------------------------
                // LOGIC BARU (DIPERBAIKI): FILTER WAKTU DENGAN NORMALISASI
                // ---------------------------------------------------------
                
                // 1. Buat Cutoff Date (Waktu Realtime saat ini)
                // Fungsi parseToUTC akan menangani baik format ISO maupun SQL
                const cutoffDate = parseToUTC(referenceUtcString);

                // 2. Filter array weatherList
                const activeWeatherList = weatherList.filter(item => {
                    if (!item.utc_datetime) return true; 
                    
                    // Konversi string forecast ("2026-02-16 17:00:00") menjadi Date UTC yang benar
                    const itemDate = parseToUTC(item.utc_datetime);

                    // Bandingkan miliseconds-nya untuk akurasi penuh
                    return itemDate.getTime() >= cutoffDate.getTime();
                });

                // 4. GENERATE LIST (Render Loop)
                // ---------------------------------------------------------
                // Siapkan Container
                const todayContainer = document.getElementById('pub-today-container');
                const futureContainer = document.getElementById('pub-future-list');

                // Reset HTML
                todayContainer.innerHTML = '';
                futureContainer.innerHTML = '';

                const groups = {};
                activeWeatherList.forEach(item => {
                    const dateKey = item.local_datetime.split(' ')[0];
                    if (!groups[dateKey]) groups[dateKey] = [];
                    groups[dateKey].push(item);
                });

                const dateKeys = Object.keys(groups);

                // Render Loop
                dateKeys.forEach((dateKey, index) => {
                    const items = groups[dateKey];
                    const dateObj = new Date(dateKey);
                    let dayLabel = dateObj.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long' });
                    
                    let badge = "";
                    let borderColor = "border-slate-200";
                    let targetContainer = futureContainer; // Default ke bawah (Besok/Lusa)
                    let wrapperClass = `w-full bg-white rounded-[2rem] border ${borderColor} p-6 h-full flex flex-col shadow-sm`; // Style wrapper default

                    if (index === 0) {
                        // --- HARI INI (UPCOMING) ---
                        // Target ke Kolom Kanan sebelah kartu utama
                        targetContainer = todayContainer;
                        badge = `<span class="bg-blue-600 text-white text-[10px] font-bold px-2 py-1 rounded-md ml-3 shadow-sm">HARI INI</span>`;
                        borderColor = "border-slate-200"; // Pakai border biasa agar bersih
                        // Tambahkan tinggi penuh agar sejajar kartu utama
                        wrapperClass = `w-full bg-white rounded-[3rem] border ${borderColor} p-6 h-full flex flex-col shadow-lg`; 
                    } else if (index === 1) {
                        badge = `<span class="bg-emerald-500 text-white text-[10px] font-bold px-2 py-1 rounded-md ml-3 shadow-sm">BESOK</span>`;
                    } else if (index === 2) {
                        badge = `<span class="bg-purple-500 text-white text-[10px] font-bold px-2 py-1 rounded-md ml-3 shadow-sm">LUSA</span>`;
                    }

                    // Buat Wrapper
                    const dayComponent = document.createElement('div');
                    dayComponent.className = wrapperClass;

                    const headerHtml = `
                        <div class="flex items-center mb-6 px-2">
                            <h3 class="font-bold text-slate-800 text-xl flex items-center">${dayLabel}</h3>
                            ${badge}
                        </div>
                    `;
                    
                    // Scroll Container (Tetap Horizontal Swipe)
                    const scrollContainer = document.createElement('div');
                    // Tambahkan 'flex-grow' dan 'items-center' agar kartu berada di tengah secara vertikal jika di desktop
                    scrollContainer.className = "flex gap-4 overflow-x-auto pb-6 px-2 custom-scrollbar snap-x snap-mandatory flex-grow items-center";
                    
                    let cardsHtml = "";
                    items.forEach(item => {
                        const itemDate = new Date(item.local_datetime.replace(' ', 'T'));
                        const jam = itemDate.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
                        
                        const wdTranslated = translateDirection(item.wd);
                        const wdDeg = item.wd_deg || 0;

                        // UI CARD (Kode Card kamu TIDAK SAYA UBAH, hanya paste ulang)
                        const mobileCard = `
                            <div class="lg:hidden flex flex-col items-center justify-center gap-2">
                                <span class="text-xs font-bold text-slate-400 bg-slate-50 px-2 py-0.5 rounded-full">${jam}</span>
                                <img src="${item.image}" class="w-10 h-10 my-1" alt="Icon">
                                <span class="text-lg font-black text-slate-800">${item.t}Â°</span>
                                <span class="text-[9px] font-bold text-center text-blue-600 leading-tight px-1 truncate w-full">${item.weather_desc}</span>
                            </div>
                        `;

                        const desktopCard = `
                            <div class="hidden lg:flex flex-col w-[200px] h-full justify-between">
                                <div class="flex flex-col items-center mb-2">
                                        <div class="text-lg font-extrabold text-slate-800 mb-1">${jam}</div> 
                                        <img src="${item.image}" class="w-14 h-14 drop-shadow-sm" alt="Icon">
                                        <div class="text-3xl font-black text-slate-800 mt-1">${item.t} <span class="text-lg font-bold text-slate-500">Â°C</span></div>
                                        <div class="text-sm font-semibold text-slate-600 text-center leading-tight h-10 flex items-center justify-center">${item.weather_desc}</div>
                                </div>
                                <div class="bg-white rounded-xl border border-slate-100 p-3 w-full shadow-sm text-sm">
                                    <div class="flex justify-between items-center border-b border-slate-50 pb-2 mb-2">
                                        <div class="flex items-center text-slate-400 gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-400" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg></div>
                                        <span class="font-bold text-slate-700">${item.hu}%</span>
                                    </div>
                                    <div class="flex justify-between items-center border-b border-slate-50 pb-2 mb-2">
                                        <div class="flex items-center text-slate-400 gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div>
                                        <span class="font-bold text-slate-700">${item.ws} km/j</span>
                                    </div>
                                    <div class="flex justify-between items-center border-b border-slate-50 pb-2 mb-2">
                                        <div class="flex items-center text-slate-400 gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg></div>
                                        <div class="flex items-center gap-1">
                                            <span class="font-bold text-slate-700 text-xs">${wdTranslated}</span>
                                            <svg xmlns="http://www.w3.org/2000/svg" style="transform: rotate(${wdDeg - 180}deg);" class="h-3 w-3 text-slate-800 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" /></svg>
                                        </div>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center text-slate-400 gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg></div>
                                        <span class="font-bold text-slate-700">${item.vs_text}</span>
                                    </div>
                                </div>
                            </div>
                        `;

                        cardsHtml += `<div class="snap-start flex-shrink-0 min-w-[100px] lg:min-w-[220px] bg-white lg:bg-blue-50 p-3 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-all hover:-translate-y-1">${mobileCard}${desktopCard}</div>`;
                    });

                    scrollContainer.innerHTML = cardsHtml;
                    dayComponent.innerHTML = headerHtml;
                    dayComponent.appendChild(scrollContainer);

                    // Masukkan ke container yang sesuai (Kanan atau Bawah)
                    targetContainer.appendChild(dayComponent);
                });

            } catch (err) { 
                console.error(err); 
                titleEl.innerText = "Gagal Memuat"; 
                dateEl.innerText = "-";
            }
        }

        // === GEMPA BUMI LOGIC (NEW) ===
        let gempaMainMap;
        let gempaMarker;

        function initGempaPage() {
            // Init Main Map for Gempa
            gempaMainMap = L.map('gempa-main-map').setView([-2, 118], 5);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
            }).addTo(gempaMainMap);

            fetchGempaTerkini();
            fetchGempaList();
        }

        function switchGempaTab(tab) {
            const mapView = document.getElementById('gempa-main-map');
            const shakemapView = document.getElementById('gempa-shakemap-view');
            const img = document.getElementById('gempa-shakemap-img');
            
            // Tombol (untuk styling aktif/nonaktif)
            const btnPeta = document.getElementById('btn-tab-peta');
            const btnShakemap = document.getElementById('btn-tab-shakemap');

            if (tab === 'shakemap') {
                // Tampilkan Shakemap
                shakemapView.classList.remove('hidden'); // Hapus hidden
                shakemapView.classList.add('flex');      // Pastikan flex aktif
                
                // PENTING: Inject URL gambar disini jika src masih kosong
                // Contoh logika:
                if(img.getAttribute('src') === "") {
                     img.src = "https://static.bmkg.go.id/20260213221223.mmi.jpg"; // Ganti dengan URL dinamis kamu
                }

                // Update Style Tombol (Opsional)
                btnShakemap.classList.add('bg-white', 'shadow-sm', 'text-slate-900', 'ring-1', 'ring-slate-200');
                btnShakemap.classList.remove('bg-slate-200', 'text-slate-600');
                
                btnPeta.classList.remove('bg-white', 'shadow-sm', 'text-slate-900', 'ring-1', 'ring-slate-200');
                btnPeta.classList.add('bg-slate-200', 'text-slate-600');

            } else {
                // Tampilkan Peta Utama
                shakemapView.classList.add('hidden');
                shakemapView.classList.remove('flex');

                // Update Style Tombol
                btnPeta.classList.add('bg-white', 'shadow-sm', 'text-slate-900', 'ring-1', 'ring-slate-200');
                btnPeta.classList.remove('bg-slate-200', 'text-slate-600');
                
                btnShakemap.classList.remove('bg-white', 'shadow-sm', 'text-slate-900', 'ring-1', 'ring-slate-200');
                btnShakemap.classList.add('bg-slate-200', 'text-slate-600');
            }
        }

        async function fetchGempaTerkini() {
            try {
                const url = encodeURIComponent('https://data.bmkg.go.id/DataMKG/TEWS/autogempa.json');
                const res = await fetch(`${PROXY_BASE}?url=${url}`);
                const data = await res.json();
                const g = data.Infogempa.gempa;

                document.getElementById('gempa-mag').innerText = g.Magnitude;
                document.getElementById('gempa-waktu').innerText = `${g.Tanggal}, ${g.Jam}`;
                document.getElementById('gempa-lokasi').innerText = g.Wilayah;
                document.getElementById('gempa-koordinat').innerText = g.Coordinates;
                document.getElementById('gempa-kedalaman').innerText = g.Kedalaman;
                document.getElementById('gempa-potensi').innerText = g.Potensi;
                
                if (g.Dirasakan && g.Dirasakan !== "-") {
                    const elDirasakan = document.getElementById('gempa-dirasakan');
                    elDirasakan.innerText = "Dirasakan: " + g.Dirasakan;
                    elDirasakan.classList.remove('hidden');
                }

                // Handle Map
                const [lat, lon] = g.Coordinates.split(',').map(parseFloat);
                if (gempaMarker && gempaMainMap) gempaMainMap.removeLayer(gempaMarker);
                
                // Add Pulse Effect
                const customIcon = L.divIcon({
                    className: 'css-icon',
                    html: '<div class="quake-ring"></div><div style="background-color: #ef4444; width: 14px; height: 14px; border-radius: 50%; border: 2px solid white;"></div>',
                    iconSize: [20,20],
                    iconAnchor: [10,10]
                });

                if(gempaMainMap) {
                    gempaMarker = L.marker([lat, lon], {icon: customIcon}).addTo(gempaMainMap);
                    gempaMainMap.setView([lat, lon], 7);
                }

                // Handle Shakemap
                const imgEl = document.getElementById('gempa-shakemap-img');
                const loader = document.getElementById('shakemap-loader');
                imgEl.onload = () => loader.classList.add('hidden');
                imgEl.onerror = () => { loader.innerHTML = '<span class="text-xs text-slate-400">Shakemap belum tersedia</span>'; };
                imgEl.src = `https://static.bmkg.go.id/${g.Shakemap}`;

            } catch (e) { console.error("AutoGempa Error:", e); }
        }

        async function fetchGempaList() {
            const listDirasakan = document.getElementById('list-gempa-dirasakan');
            const listBesar = document.getElementById('list-gempa-besar');

            // Helper render
            const renderItem = (g, type) => {
                const magColor = parseFloat(g.Magnitude) >= 6 ? 'bg-red-500' : (parseFloat(g.Magnitude) >= 5 ? 'bg-orange-500' : 'bg-yellow-500');
                return `
                <div class="bg-white p-4 rounded-2xl border border-slate-100 hover:shadow-md transition-all flex gap-4 items-start">
                    <div class="${magColor} text-white w-12 h-12 rounded-xl flex flex-col items-center justify-center flex-shrink-0 shadow-sm">
                        <span class="text-lg font-black leading-none">${g.Magnitude}</span>
                        <span class="text-[8px] font-bold">MAG</span>
                    </div>
                    <div class="flex-1">
                        <div class="flex justify-between items-start mb-1">
                            <h4 class="text-sm font-bold text-slate-800 leading-tight">${g.Wilayah}</h4>
                            <span class="text-[10px] text-slate-400 font-mono whitespace-nowrap ml-2">${g.Jam}</span>
                        </div>
                        <p class="text-xs text-slate-500 mb-2">${g.Tanggal}</p>
                        <div class="flex flex-wrap gap-2">
                             <span class="text-[10px] bg-slate-100 px-2 py-0.5 rounded text-slate-600 font-bold border border-slate-200">Kedalaman: ${g.Kedalaman}</span>
                             ${type === 'dirasakan' ? `<span class="text-[10px] bg-orange-50 px-2 py-0.5 rounded text-orange-700 font-bold border border-orange-100 w-full mt-1">${g.Dirasakan.substring(0, 50)}${g.Dirasakan.length>50?'...':''}</span>` : ''}
                        </div>
                    </div>
                </div>`;
            };

            try {
                // Fetch Dirasakan
                const res1 = await fetch(`${PROXY_BASE}?url=${encodeURIComponent('https://data.bmkg.go.id/DataMKG/TEWS/gempadirasakan.json')}`);
                const json1 = await res1.json();
                let html1 = '';
                json1.Infogempa.gempa.slice(0, 15).forEach(g => { html1 += renderItem(g, 'dirasakan'); });
                listDirasakan.innerHTML = html1;

                // Fetch Besar
                const res2 = await fetch(`${PROXY_BASE}?url=${encodeURIComponent('https://data.bmkg.go.id/DataMKG/TEWS/gempaterkini.json')}`);
                const json2 = await res2.json();
                let html2 = '';
                json2.Infogempa.gempa.slice(0, 15).forEach(g => { html2 += renderItem(g, 'besar'); });
                listBesar.innerHTML = html2;

            } catch (e) {
                console.error("List Gempa Error:", e);
                listDirasakan.innerHTML = '<p class="text-center text-red-500 text-sm">Gagal memuat data.</p>';
                listBesar.innerHTML = '<p class="text-center text-red-500 text-sm">Gagal memuat data.</p>';
            }
        }

        // --- ALERT SYSTEM & MODAL LOGIC ---
        let alertModalMap = null;
        let alertModalPolygonGroup = null;

        async function fetchAlertsPage() {
            const container = document.getElementById('alert-page-list');
            container.innerHTML = ""; // reset

            try {
                const rssUrl = encodeURIComponent('https://www.bmkg.go.id/alerts/nowcast/id/rss.xml');
                const res = await fetch(`${PROXY_BASE}?url=${rssUrl}`);
                if (!res.ok) throw new Error('RSS Failed');

                const text = await res.text();
                const xmlDoc = new DOMParser().parseFromString(text, "text/xml");
                const items = xmlDoc.querySelectorAll("item");

                let count = 0;

                items.forEach(item => {
                    count++;

                    const title = item.querySelector("title")?.textContent || "";
                    const link = item.querySelector("link")?.textContent || "";
                    const date = item.querySelector("pubDate")?.textContent || "";
                    const rawDesc = item.querySelector("description")?.textContent || "";

                    // --- Potong deskripsi ---
                    let displayDesc = rawDesc;
                    if (rawDesc.length > 200) {
                        const cutIdx = rawDesc.lastIndexOf(' ', 200);
                        displayDesc = rawDesc.substring(0, cutIdx > 0 ? cutIdx : 200) + "...";
                    }

                    // --- Card Wrapper ---
                    const card = document.createElement("div");
                    card.className = "bg-white p-6 rounded-3xl border border-l-4 border-l-red-500 border-slate-200 shadow-sm hover:shadow-md transition-all";

                    const flex = document.createElement("div");
                    flex.className = "flex items-start justify-between gap-4";

                    const contentWrap = document.createElement("div");
                    contentWrap.className = "w-full";

                    // --- Title ---
                    const h3 = document.createElement("h3");
                    h3.className = "font-bold text-xl text-slate-900 mb-2";
                    h3.textContent = title;

                    // --- Date ---
                    const pDate = document.createElement("p");
                    pDate.className = "text-xs text-slate-500 mb-4 font-mono uppercase tracking-wider";
                    pDate.textContent = date;

                    // --- Description ---
                    const descDiv = document.createElement("div");
                    descDiv.className = "text-sm text-slate-600 mb-4 leading-relaxed";
                    descDiv.textContent = displayDesc; // SAFE

                    // --- Button ---
                    const button = document.createElement("button");
                    button.className = "inline-flex items-center gap-2 text-sm font-bold text-blue-600 hover:text-blue-800 transition-colors";
                    button.textContent = "Selengkapnya";

                    button.addEventListener("click", () => {
                        openAlertModal(link);
                    });

                    contentWrap.appendChild(h3);
                    contentWrap.appendChild(pDate);
                    contentWrap.appendChild(descDiv);
                    contentWrap.appendChild(button);

                    flex.appendChild(contentWrap);
                    card.appendChild(flex);
                    container.appendChild(card);
                });

                if (count === 0) {
                    const emptyDiv = document.createElement("div");
                    emptyDiv.className = "text-center py-16 bg-green-50 rounded-3xl border border-green-200";

                    const h3 = document.createElement("h3");
                    h3.className = "text-2xl font-bold text-green-900 mb-2";
                    h3.textContent = "Tidak Ada Peringatan";

                    const p = document.createElement("p");
                    p.className = "text-green-700";
                    p.textContent = "Saat ini tidak ada peringatan dini cuaca ekstrem yang terdeteksi oleh sistem.";

                    emptyDiv.appendChild(h3);
                    emptyDiv.appendChild(p);
                    container.appendChild(emptyDiv);
                }

                lucide.createIcons();

            } catch (e) {
                console.error(e);
                container.textContent = "Gagal memuat daftar peringatan.";
            }
        }



        async function openAlertModal(url) {
            const modal = document.getElementById('alert-modal');
            const content = document.getElementById('modal-content');
            const mapContainer = document.getElementById('modal-map-container');
            const titleEl = document.getElementById('modal-title');

            modal.classList.remove('hidden');
            content.textContent = "Memuat data...";
            mapContainer.classList.add('hidden');

            try {
                const res = await fetch(`${PROXY_BASE}?url=${encodeURIComponent(url)}`);
                const text = await res.text();
                const xmlDoc = new DOMParser().parseFromString(text, "text/xml");
                const info = xmlDoc.querySelector("info");
                if (!info) throw new Error("Info block not found");

                const event = info.querySelector("event")?.textContent || "-";
                const desc = info.querySelector("description")?.textContent || "-";
                const areaDesc = info.querySelector("areaDesc")?.textContent || "-";
                const severity = info.querySelector("severity")?.textContent || "-";
                const effective = info.querySelector("effective")?.textContent || "-";
                const expires = info.querySelector("expires")?.textContent || "-";
                const webImage = info.querySelector("web")?.textContent || null;

                titleEl.textContent = "Detail: " + event;

                content.innerHTML = ""; // reset aman

                const wrapper = document.createElement("div");
                wrapper.className = "space-y-4 text-sm";

                function addField(label, value) {
                    const div = document.createElement("div");

                    const strong = document.createElement("strong");
                    strong.textContent = label + ": ";

                    const span = document.createElement("span");
                    span.textContent = value;

                    div.appendChild(strong);
                    div.appendChild(span);

                    wrapper.appendChild(div);
                }

                addField("Peristiwa", event);
                addField("Wilayah", areaDesc);
                addField("Level", severity);
                addField("Berlaku", effective);
                addField("Berakhir", expires);

                const descDiv = document.createElement("div");
                descDiv.className = "mt-4 whitespace-pre-line";
                descDiv.textContent = desc;
                wrapper.appendChild(descDiv);

                // Optional Image (VALIDASI URL)
                if (webImage) {
                    try {
                        const parsed = new URL(webImage);
                        if (parsed.protocol === "https:" && parsed.hostname.endsWith("bmkg.go.id")) {
                            const img = document.createElement("img");
                            img.src = webImage;
                            img.alt = "Peta Peringatan";
                            img.className = "mt-4 rounded-xl border";
                            wrapper.appendChild(img);
                        }
                    } catch (e) {
                        console.warn("Invalid image URL skipped");
                    }
                }

                content.appendChild(wrapper);

            } catch (err) {
                console.error(err);
                content.textContent = "Gagal memuat detail peringatan.";
            }
        }

        
        function closeAlertModal() {
            document.getElementById('alert-modal').classList.add('hidden');
        }

        // --- EXISTING LOGIC BELOW (Map, Weather, Time) ---
        function displayDate() {
            const options = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            };
            document.getElementById('current-date').innerText = new Date().toLocaleDateString('id-ID', options);
        }

        function initMap() {
            map = L.map('map').setView([0.8000, 127.3800], 10);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap'
            }).addTo(map);
        }
        async function loadRegionData() {
            try {
                const res = await fetch(`${META_PATH}/kodewilayah_tree.json`);
                if (!res.ok) throw new Error('API request failed');
                regionTree = await res.json();
            } catch (e) {
                console.error("Gagal memuat wilayah:", e);
                regionTree = [];
            } finally {
                processRegions();
                fillProvSelect();
            }
        }

        function processRegions() {
            flattenedRegions = [];
            regionTree.forEach(prov => {
                flattenedRegions.push({
                    id: prov.code,
                    name: prov.name,
                    path: `Indonesia`,
                    type: 'Provinsi'
                });
                if (prov.children) {
                    prov.children.forEach(kab => {
                        flattenedRegions.push({
                            id: kab.code,
                            name: kab.name,
                            path: `${prov.name}`,
                            type: 'Kab/Kota'
                        });
                        if (kab.children) {
                            kab.children.forEach(kec => {
                                flattenedRegions.push({
                                    id: kec.code,
                                    name: kec.name,
                                    path: `${prov.name} > ${kab.name}`,
                                    type: 'Kecamatan'
                                });
                                if (kec.children) {
                                    kec.children.forEach(desa => {
                                        flattenedRegions.push({
                                            id: desa.code,
                                            name: desa.name,
                                            path: `${prov.name} > ${kab.name} > ${kec.name}`,
                                            type: 'Desa/Kel'
                                        });
                                    });
                                }
                            });
                        }
                    });
                }
            });
        }

        function fillProvSelect() {
            const provSel = document.getElementById('sel-prov');
            provSel.innerHTML = '<option value="">Pilih Provinsi</option>';
            regionTree.forEach(p => {
                const opt = document.createElement('option');
                opt.value = p.code;
                opt.textContent = p.name;
                if (p.name.includes("MALUKU UTARA")) opt.selected = true;
                provSel.appendChild(opt);
            });
            handleProvChange();
        }

        function handleProvChange() {
            const provId = document.getElementById('sel-prov').value;
            const kabSel = document.getElementById('sel-kab');
            const prov = regionTree.find(p => p.code === provId);
            kabSel.innerHTML = '<option value="">Pilih Kabupaten/Kota</option>';
            kabSel.disabled = true;
            document.getElementById('sel-kec').innerHTML = '<option value="">Pilih Kecamatan</option>';
            document.getElementById('sel-kec').disabled = true;
            document.getElementById('sel-desa').innerHTML = '<option value="">Pilih Desa/Kelurahan</option>';
            document.getElementById('sel-desa').disabled = true;
            document.getElementById('btn-show-weather').disabled = true;
            if (prov && prov.children) {
                kabSel.disabled = false;
                prov.children.forEach(k => {
                    const opt = document.createElement('option');
                    opt.value = k.code;
                    opt.textContent = k.name;
                    kabSel.appendChild(opt);
                });
            }
        }

        function handleKabChange() {
            const provId = document.getElementById('sel-prov').value;
            const kabId = document.getElementById('sel-kab').value;
            const kecSel = document.getElementById('sel-kec');
            const prov = regionTree.find(p => p.code === provId);
            const kab = prov?.children?.find(k => k.code === kabId);
            kecSel.innerHTML = '<option value="">Pilih Kecamatan</option>';
            kecSel.disabled = true;
            document.getElementById('sel-desa').innerHTML = '<option value="">Pilih Desa/Kelurahan</option>';
            document.getElementById('sel-desa').disabled = true;
            document.getElementById('btn-show-weather').disabled = true;
            if (kab && kab.children) {
                kecSel.disabled = false;
                kab.children.forEach(k => {
                    const opt = document.createElement('option');
                    opt.value = k.code;
                    opt.textContent = k.name;
                    kecSel.appendChild(opt);
                });
            }
        }

        function handleKecChange() {
            const provId = document.getElementById('sel-prov').value;
            const kabId = document.getElementById('sel-kab').value;
            const kecId = document.getElementById('sel-kec').value;
            const desaSel = document.getElementById('sel-desa');
            const prov = regionTree.find(p => p.code === provId);
            const kab = prov?.children?.find(k => k.code === kabId);
            const kec = kab?.children?.find(k => k.code === kecId);
            desaSel.innerHTML = '<option value="">Pilih Desa/Kelurahan</option>';
            desaSel.disabled = true;
            document.getElementById('btn-show-weather').disabled = true;
            if (kec && kec.children) {
                desaSel.disabled = false;
                kec.children.forEach(d => {
                    const opt = document.createElement('option');
                    opt.value = d.code;
                    opt.textContent = d.name;
                    desaSel.appendChild(opt);
                });
            }
        }

        function handleDesaChange() {
            document.getElementById('btn-show-weather').disabled = !document.getElementById('sel-desa').value;
        }

        function updateWeatherFromSelect() {
            const desaId = document.getElementById('sel-desa').value;
            if (desaId) {
                document.getElementById('advanced-filter-menu').classList.add('hidden');
                document.getElementById('advanced-filter-menu').classList.remove('flex');
                fetchWeather(desaId);
            }
        }

        function parseTime(item) {
            const timeStr = item.local_datetime || item.datetime || "";
            if (!timeStr) return "--:--";
            if (timeStr.includes(' ')) return timeStr.split(' ')[1].substring(0, 5);
            if (timeStr.length >= 12 && !isNaN(timeStr)) return timeStr.substring(8, 10) + ":" + timeStr.substring(10, 12);
            return timeStr;
        }

        function safeFlyTo(lat, lon, zoom) {
            if (map && !isNaN(lat) && !isNaN(lon) && map.getContainer().offsetParent !== null) {
                try {
                    map.flyTo([lat, lon], zoom, {
                        duration: 1.5
                    });
                } catch (e) {
                    console.warn("FlyTo failed:", e);
                }
            }
        }
        async function fetchWeather(admCode) {
            try {
                // 0. RESET UI
                document.getElementById('main-temp').innerText = "--Â°";
                document.getElementById('weather-desc').innerText = "Mengambil data...";
                document.getElementById('update-timestamp').innerText = "Memperbarui...";

                // ---------------------------------------------------------
                // 1. FETCH DATA PRAKIRAAN (Sumber Kebenaran Lokasi)
                // ---------------------------------------------------------
                const resForecast = await fetch(`${API_BASE}/prakiraan-cuaca?adm4=${admCode}`);
                if (!resForecast.ok) throw new Error('Forecast API Failed');

                const resultForecast = await resForecast.json();
                if (!resultForecast.data || !resultForecast.data[0]) return;

                const weatherData = resultForecast.data[0];
                const cuacaList = weatherData.cuaca.flat();
                
                const lat = parseFloat(weatherData.lokasi.lat);
                const lon = parseFloat(weatherData.lokasi.lon);

                // === PERBAIKAN PENTING ===
                // Ambil Timezone ID yang BENAR dari root object lokasi forecast
                // Contoh: "Asia/Jayapura", "Asia/Makassar", atau "Asia/Jakarta"
                // Fallback ke Jakarta jika null.
                const correctTimezone = resultForecast.lokasi.timezone || 'Asia/Jakarta';
                console.log("Zona Waktu Terdeteksi:", correctTimezone);

                document.getElementById('location-name').innerText = `${weatherData.lokasi.desa}, ${weatherData.lokasi.kecamatan}`;

                // ---------------------------------------------------------
                // 2. FETCH DATA REALTIME
                // ---------------------------------------------------------
                
                let currentData = cuacaList[0]; 
                let isRealtime = false;
                
                // Kita siapkan waktu default dari forecast dulu
                // Karena local_datetime di forecast sudah benar (hasil perhitungan array server yg kompleks)
                let finalTime = currentData.local_datetime; 

                try {
                    const realtimeUrl = `https://cuaca.bmkg.go.id/api/presentwx/coord?lat=${lat}&lon=${lon}`;
                    const resRealtime = await fetch(`${PROXY_BASE}?url=${encodeURIComponent(realtimeUrl)}`);
                    const jsonRealtime = await resRealtime.json();

                    if (jsonRealtime.status === 200 && jsonRealtime.data && jsonRealtime.data.cuaca) {
                        currentData = jsonRealtime.data.cuaca; 
                        isRealtime = true;
                        
                        // === LOGIKA PERBAIKAN WAKTU ===
                        // Jangan percaya 'local_datetime' dari API Realtime karena sering bias ke WIB.
                        // Kita ambil UTC-nya ('datetime') lalu konversi manual pakai timezone dari Forecast.
                        
                        if (currentData.datetime) {
                            const utcDate = new Date(currentData.datetime); // Parse UTC
                            
                            // Format manual ke String sesuai Zona Waktu Lokasi
                            finalTime = utcDate.toLocaleString('sv-SE', {
                                timeZone: correctTimezone, // Pakai zona waktu dari Fetch 1 (Ternate = Asia/Jayapura)
                                year: 'numeric', month: '2-digit', day: '2-digit',
                                hour: '2-digit', minute: '2-digit', second: '2-digit',
                                hour12: false
                            }).replace(' ', ' '); 
                        } 
                        // Fallback: Jika tidak ada datetime UTC, terpaksa pakai local_datetime (meski mungkin salah)
                        else if (currentData.local_datetime) {
                            finalTime = currentData.local_datetime;
                        }
                    }
                } catch (err) {
                    console.warn("Realtime fetch failed", err);
                }

                // ---------------------------------------------------------
                // 3. UPDATE UI
                // ---------------------------------------------------------

                // Label sekarang pasti benar sesuai zona waktu lokasi (bukan server)
                document.getElementById('update-timestamp').innerText = `Pemutakhiran: ${finalTime} (Waktu Setempat)`;

                document.getElementById('main-temp').innerText = `${currentData.t}Â°`;
                document.getElementById('weather-desc').innerText = currentData.weather_desc || 'Berawan';
                document.getElementById('wind-speed').innerText = `${currentData.ws} km/j`;
                document.getElementById('humidity').innerText = `${currentData.hu}%`;
                document.getElementById('visibility').innerText = currentData.vs_text || '--';
                
                // Logic Hujan
                const rainForecast = parseFloat(cuacaList[0].tp) || 0;
                const rainRealtime = parseFloat(currentData.tp) || 0;
                const rainVal = (isRealtime && rainRealtime === 0) ? rainForecast : rainRealtime;
                
                document.getElementById('precipitation').innerText = `${rainVal} mm`;

                if (currentData.image) {
                    document.getElementById('weather-icon').src = currentData.image;
                }

                // ---------------------------------------------------------
                // 4. UPDATE PETA
                // ---------------------------------------------------------
                if (!isNaN(lat) && !isNaN(lon)) {
                    safeFlyTo(lat, lon, 11);
                    map.eachLayer(l => { if (l instanceof L.Marker) l.remove(); });
                    
                    L.marker([lat, lon]).addTo(map)
                        .bindPopup(`
                            <div class="text-center">
                                <b>${weatherData.lokasi.desa}</b><br>
                                ${currentData.weather_desc}<br>
                                <span class="text-[10px] text-slate-500">Update: ${finalTime}</span>
                            </div>
                        `)
                        .openPopup();
                }

                // ---------------------------------------------------------
                // 5. UPDATE LIST
                // ---------------------------------------------------------
                const hourlyContainer = document.getElementById('hourly-forecast');
                hourlyContainer.innerHTML = '';
                
                cuacaList.forEach(item => {
                    const timeLabel = parseTime(item);
                    const dayLabel = new Date(item.local_datetime.replace(' ', 'T')).toLocaleDateString('id-ID', {
                        weekday: 'short', day: 'numeric'
                    });
                    
                    const div = document.createElement('div');
                    div.className = "flex items-center justify-between p-4 bg-slate-50 rounded-2xl border border-slate-100 hover:border-blue-200 transition-all";
                    div.innerHTML = `
                        <div class="flex flex-col w-16">
                            <span class="text-xs font-bold text-slate-500 uppercase tracking-wider">${timeLabel}</span>
                            <span class="text-[10px] text-slate-400 font-semibold">${dayLabel}</span>
                        </div>
                        <div class="flex flex-1 items-center gap-3 px-2">
                            ${item.image ? `<img src="${item.image}" class="w-8 h-8">` : ''}
                            <div class="flex flex-col">
                                <span class="text-sm font-semibold text-slate-700">${item.weather_desc}</span>
                                ${parseFloat(item.tp) > 0 ? `<span class="text-[10px] text-blue-500 font-bold">${item.tp} mm hujan</span>` : ''}
                            </div>
                        </div>
                        <span class="text-base font-black text-blue-900">${item.t}Â°</span>
                    `;
                    hourlyContainer.appendChild(div);
                });
                
                lucide.createIcons();

            } catch (err) {
                console.error(err);
                document.getElementById('weather-desc').innerText = "Gagal memuat data.";
            }
        }
        let alertPolygonGroup = null;
        async function fetchAlerts() {
            const list = document.getElementById('alert-list-cuaca');
            list.innerHTML = `<div class="p-4 text-center text-slate-500 text-sm">Memuat peringatan...</div>`;
            try {
                const rssUrl = encodeURIComponent('https://www.bmkg.go.id/alerts/nowcast/id/rss.xml');
                const res = await fetch(`${PROXY_BASE}?url=${rssUrl}`);
                if (!res.ok) throw new Error('RSS Failed');
                const xmlDoc = new DOMParser().parseFromString(await res.text(), "text/xml");
                const items = xmlDoc.querySelectorAll("item");
                let alertHtml = '';
                let alertFound = false;
                if (alertPolygonGroup) map.removeLayer(alertPolygonGroup);
                alertPolygonGroup = L.featureGroup().addTo(map);
                for (const item of items) {
                    const title = item.querySelector("title")?.textContent || "";
                    if (!title.toLowerCase().includes("maluku utara")) continue;
                    alertFound = true;
                    const desc = (item.querySelector("description")?.textContent || "").replace(/\n/g, '<br>');
                    const date = item.querySelector("pubDate")?.textContent || "";
                    alertHtml += `<div class="p-6 bg-orange-50 rounded-3xl border border-orange-200 shadow-sm"><div class="flex gap-4"><div class="w-10 h-10 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center flex-shrink-0"><i data-lucide="alert-triangle"></i></div><div><h4 class="font-bold text-orange-900">${title}</h4><p class="text-xs text-orange-700 mt-1 mb-2">${date}</p><div class="text-sm text-orange-800 max-h-40 overflow-y-auto pr-2 custom-scrollbar">${desc}</div></div></div></div>`;
                    const link = item.querySelector("link")?.textContent;
                    if (link) {
                        try {
                            const capRes = await fetch(`${PROXY_BASE}?url=${encodeURIComponent(link)}`);
                            const capDoc = new DOMParser().parseFromString(await capRes.text(), "text/xml");
                            capDoc.querySelectorAll("polygon").forEach(p => {
                                const coords = p.textContent.trim().split(' ').map(pair => {
                                    const [lat, lon] = pair.split(',');
                                    return [parseFloat(lat), parseFloat(lon)];
                                }).filter(c => !isNaN(c[0]));
                                if (coords.length) L.polygon(coords, {
                                    color: '#ef4444',
                                    fillColor: '#f97316',
                                    fillOpacity: 0.4
                                }).addTo(alertPolygonGroup).bindPopup(title);
                            });
                        } catch (e) {}
                    }
                }
                if (alertFound && alertPolygonGroup.getLayers().length && map.getContainer().offsetParent !== null) {
                    try {
                        map.fitBounds(alertPolygonGroup.getBounds(), {
                            padding: [50, 50]
                        });
                    } catch (e) {}
                }
                if (!alertFound) alertHtml = `<div class="flex flex-col items-center justify-center p-8 bg-green-50/50 rounded-3xl border border-green-100 text-center shadow-sm">
    
    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4">
        <i data-lucide="shield-check" class="w-8 h-8 text-green-600"></i>
    </div>

    <h4 class="text-lg font-bold text-green-900 tracking-tight">
        Kondisi Aman
    </h4>

    <p class="text-sm text-green-700/80 mt-1 mb-4 leading-relaxed">
        Saat ini tidak ada peringatan dini cuaca ekstrem di wilayah Maluku Utara.
    </p>

    <button onclick="switchView('view-peringatan')" class="inline-flex items-center gap-1.5 px-4 py-2 bg-white border border-green-200 rounded-full text-xs font-bold text-green-700 hover:bg-green-50 hover:text-green-800 transition-colors shadow-sm">
        <span>Cek Daerah Lain</span>
        <i data-lucide="arrow-right" class="w-3 h-3"></i>
    </button>
</div>`;
                list.innerHTML = alertHtml;
                lucide.createIcons();
            } catch (e) {
                list.innerHTML = `<div class="p-4 text-center text-red-500 text-sm">Gagal memuat data.</div>`;
            }
        }
        let serverOffset = 0;
        async function syncBMKG() {
            try {
                const start = Date.now();
                const res = await fetch(`${API_INTERNAL}/bmkg-time.php`);
                const data = await res.json();
                if (data.status === 'success') serverOffset = (data.server_time_utc + (Date.now() - start) / 2) - Date.now();
            } catch (e) {}
        }

        function updateClocks() {
            const now = new Date(Date.now() + serverOffset);
            const utc = new Date(now.getTime() + (now.getTimezoneOffset() * 60000));
            const fmt = (offset) => new Date(utc.getTime() + (offset * 3600000)).toLocaleTimeString('id-ID', {
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const dat = (offset) => new Date(utc.getTime() + (offset * 3600000)).toLocaleDateString('id-ID', {
                day: 'numeric',
                month: 'short',
                year: 'numeric'
            });
            document.getElementById('bar-utc').textContent = utc.toLocaleTimeString('en-GB', {
                hour12: false
            });
            ['wib', 'wita', 'wit'].forEach((z, i) => {
                const t = fmt(7 + i);
                const d = dat(7 + i);
                document.getElementById(`bar-${z}`).textContent = t;
                if (document.getElementById(`clock-${z}`)) {
                    document.getElementById(`clock-${z}`).textContent = t;
                    document.getElementById(`date-${z}`).textContent = d;
                }
            });
            if (document.getElementById('clock-utc')) {
                document.getElementById('clock-utc').textContent = utc.toLocaleTimeString('en-GB', {
                    hour12: false
                });
                document.getElementById('date-utc').textContent = dat(0);
            }
        }
        syncBMKG();
        setInterval(updateClocks, 1000);
        setInterval(syncBMKG, 300000);
    </script>



        <!-- SCRIP MARITIM -->
<script>
    const maritimApp = {
        data: {},
        activeCategory: 'pelabuhan',
        activeUrl: '', 
        activeName: '', 
        isMobile: window.innerWidth < 1024,

        init: function() {
                // Fetch JSON
                fetch(`${META_PATH}/maritim-meta.json`)
                    .then(res => res.json())
                    .then(response => {
                        response.categories.forEach(cat => {
                            this.data[cat.category_name] = cat.data;
                        });
                        
                        // Render List saja
                        this.renderList();
                        
                        // === PERBAIKAN: HANYA SIMPAN DATA, JANGAN LOAD IFRAME ===
                        if (this.data['pelabuhan'] && this.data['pelabuhan'].length > 0) {
                            const first = this.data['pelabuhan'][0];
                            // Kita simpan data pelabuhan pertama sebagai "lastLoadedItem"
                            // TAPI JANGAN panggil loadDesktopIframe()
                            this.lastLoadedItem = first; 
                            this.activeName = first.name;
                            this.activeUrl = first.url;
                            
                            // Kita highlight visualnya saja di list (opsional), tapi iframe tetap mati
                            setTimeout(() => this.highlightItem(first.name), 100);
                        }
                    })
                    .catch(err => {
                        console.error("Error:", err);
                        document.getElementById('maritimList').innerHTML = `<div class="p-4 text-center text-red-500 text-xs">Gagal koneksi server.</div>`;
                    });

                window.addEventListener('resize', () => {
                    this.isMobile = window.innerWidth < 1024;
                });
            },

        // --- FUNGSI BARU: Dipanggil saat masuk menu Maritim ---
        mount: function() {
            // Jika tampilan desktop dan kita punya data terakhir/default
            if (!this.isMobile && this.lastLoadedItem) {
                console.log("Mounting Maritim Iframe...");
                this.loadDesktopIframe(this.lastLoadedItem);
                // Highlight item di list
                setTimeout(() => this.highlightItem(this.lastLoadedItem.name), 100);
            }
        },

        // --- FUNGSI BARU: Dipanggil saat keluar menu Maritim ---
        unmount: function() {
            console.log("Unmounting Maritim Iframe...");
            const iframe = document.getElementById('desktopIframe');
            const empty = document.getElementById('emptyState');
            const loader = document.getElementById('desktopLoader');

            // Kosongkan src untuk mematikan proses di browser
            // 'about:blank' adalah cara standar untuk mereset iframe
            if (iframe) {
                iframe.src = 'about:blank';
                // Kembalikan tampilan ke loading state agar rapi saat dibuka kembali
                iframe.style.opacity = '0'; 
            }

            // Reset loader visual
            if (loader) loader.style.display = 'flex';
        },

        // ... (SISA KODE switchCategory, renderList, dll TETAP SAMA) ...

        switchCategory: function(category) {
            // ... kode lama switchCategory ...
            this.activeCategory = category;
            // Update UI Tabs code here (copy from original)...
            // ...

            this.renderList();

            // LOGIKA BARU: Load iframe hanya jika data ada
            if (!this.isMobile && this.data[category] && this.data[category].length > 0) {
                const first = this.data[category][0];
                this.activeName = first.name; 
                this.activeUrl = first.url;
                this.lastLoadedItem = first; // Update state terakhir
                
                // PENTING: Langsung load iframe karena user sedang aktif di menu ini
                this.loadDesktopIframe(first);
                setTimeout(() => this.highlightItem(first.name), 50);
            }
        },

        handleClick: function(name, url) {
            this.activeName = name; 
            this.activeUrl = url;
            this.lastLoadedItem = { name, url }; // Simpan state
            this.highlightItem(name);

            if (this.isMobile) {
                this.openModal(name, url);
            } else {
                this.loadDesktopIframe({name, url});
            }
        },

        switchCategory: function(category) {
            this.activeCategory = category;
            
            // --- UI Tabs ---
            const btnPelabuhan = document.getElementById('tab-pelabuhan');
            const btnPerairan = document.getElementById('tab-perairan');
            
            const activeClasses = ['bg-white', 'text-blue-600', 'shadow-sm', 'ring-1', 'ring-black/5'];
            const inactiveClasses = ['bg-transparent', 'text-slate-500', 'hover:text-slate-700'];

            if (category === 'pelabuhan') {
                btnPelabuhan.classList.add(...activeClasses);
                btnPelabuhan.classList.remove('bg-transparent', 'text-slate-500', 'hover:text-slate-700');
                
                btnPerairan.classList.remove(...activeClasses);
                btnPerairan.classList.add('bg-transparent', 'text-slate-500', 'hover:text-slate-700');
            } else {
                btnPerairan.classList.add(...activeClasses);
                btnPerairan.classList.remove('bg-transparent', 'text-slate-500', 'hover:text-slate-700');
                
                btnPelabuhan.classList.remove(...activeClasses);
                btnPelabuhan.classList.add('bg-transparent', 'text-slate-500', 'hover:text-slate-700');
            }

            document.getElementById('maritimSearch').value = '';
            this.renderList();

            // Auto select item pertama di kategori baru (Desktop only)
            if (!this.isMobile && this.data[category] && this.data[category].length > 0) {
                const first = this.data[category][0];
                this.activeName = first.name; 
                this.activeUrl = first.url;   
                this.loadDesktopIframe(first);
                setTimeout(() => this.highlightItem(first.name), 50);
            }
        },

        renderList: function() {
            const container = document.getElementById('maritimList');
            const items = this.data[this.activeCategory] || [];
            
            if (items.length === 0) {
                container.innerHTML = '<div class="p-4 text-center text-slate-400 text-xs">Data kosong.</div>';
                return;
            }

            const iconName = this.activeCategory === 'pelabuhan' ? 'anchor' : 'waves';
            
            let html = '';
            items.forEach(item => {
                html += `
                    <div class="location-item group flex items-center gap-3 p-3 rounded-xl cursor-pointer hover:bg-blue-50 transition-all border-l-[3px] border-transparent mb-1" 
                         onclick="maritimApp.handleClick('${item.name}', '${item.url}')"
                         data-name="${item.name}">
                        <div class="w-8 h-8 rounded-lg bg-white border border-slate-100 flex items-center justify-center text-slate-400 group-hover:text-blue-600 group-hover:border-blue-200 transition-colors shadow-sm shrink-0">
                            <i data-lucide="${iconName}" class="w-4 h-4"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h4 class="text-sm font-bold text-slate-700 group-hover:text-blue-700 truncate">${item.name}</h4>
                            <p class="text-[10px] text-slate-400 truncate">BMKG Maritim</p>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
            if(window.lucide) lucide.createIcons();
        },

        filterList: function() {
            const query = document.getElementById('maritimSearch').value.toLowerCase();
            const items = document.querySelectorAll('.location-item');
            
            items.forEach(el => {
                const name = el.getAttribute('data-name').toLowerCase();
                if (name.includes(query)) {
                    el.style.display = 'flex';
                } else {
                    el.style.display = 'none';
                }
            });
        },

        highlightItem: function(name) {
            document.querySelectorAll('.location-item').forEach(el => {
                el.classList.remove('active');
                if (el.getAttribute('data-name') === name) {
                    el.classList.add('active');
                }
            });
        },

        handleClick: function(name, url) {
            this.activeName = name; 
            this.activeUrl = url;   
            this.highlightItem(name);

            if (this.isMobile) {
                this.openModal(name, url);
            } else {
                this.loadDesktopIframe({name, url});
            }
        },

        loadDesktopIframe: function(item) {
            const iframe = document.getElementById('desktopIframe');
            const loader = document.getElementById('desktopLoader');
            const title = document.getElementById('desktopTitle');
            const link = document.getElementById('desktopExternalLink');
            const empty = document.getElementById('emptyState');

            if(empty) empty.style.display = 'none';
            
            // Tampilkan loader saat memuat ulang
            if (iframe.src !== item.url) {
                loader.style.display = 'flex';
                iframe.style.opacity = '0.5'; 
                
                title.textContent = item.name;
                link.href = item.url;
                iframe.src = item.url;

                // Handler loading
                const onComplete = () => {
                    loader.style.display = 'none';
                    iframe.style.opacity = '1';
                };

                iframe.onload = onComplete;
                
                // Fallback timeout jika iframe macet
                setTimeout(onComplete, 5000);
            }
        },

        // Trigger dari Overlay Transparan
        expandToModal: function() {
            if(this.activeUrl) {
                this.openModal(this.activeName, this.activeUrl);
            }
        },
        openModal: function(name, url) {
            const modal = document.getElementById('maritimBrowserModal');
            const iframeModal = document.getElementById('modalIframe');
            const iframeDesktop = document.getElementById('desktopIframe');
            const urlDisplay = document.getElementById('modalUrlDisplay');
            const loader = document.getElementById('modalLoader');

            // 1. Matikan Iframe Belakang SEGERA
            if (iframeDesktop) {
                iframeDesktop.src = 'about:blank';
            }

            // 2. Setup Tampilan Modal
            try {
                const domain = new URL(url).hostname; 
                urlDisplay.textContent = domain;
            } catch (e) {
                urlDisplay.textContent = "maritim.bmkg.go.id"; 
            }
            
            // Tampilkan Modal DULU (Biarkan animasi CSS jalan lancar)
            modal.classList.remove('hidden');
            loader.style.display = 'flex';
            
            // 3. TEKNIK "NAPAS": Tunggu 300ms baru load Iframe
            // Ini membiarkan browser menyelesaikan animasi render modal dulu
            // sebelum dihajar beban loading website BMKG.
            setTimeout(() => {
                iframeModal.src = url;
                
                const onComplete = () => {
                    loader.style.display = 'none';
                };

                iframeModal.onload = onComplete;
                setTimeout(onComplete, 8000); // Timeout lebih lama utk mobile
            }, 300); 
        },

        closeModal: function() {
                    const modal = document.getElementById('maritimBrowserModal');
                    const iframeModal = document.getElementById('modalIframe');
                    
                    // IFRAME DESKTOP (Yang di belakang)
                    const iframeDesktop = document.getElementById('desktopIframe');
                    const loaderDesktop = document.getElementById('desktopLoader');
                    
                    // Tutup Modal
                    modal.classList.add('hidden');
                    
                    // --- 3. MATIKAN IFRAME MODAL ---
                    iframeModal.src = 'about:blank'; // Bersihkan memori modal
                    
                    // --- 4. HIDUPKAN KEMBALI IFRAME BELAKANG ---
                    // Kita load ulang URL terakhir yang aktif
                    if (iframeDesktop && this.activeUrl) {
                        // Tampilkan loader desktop lagi biar rapi
                        if(loaderDesktop) loaderDesktop.style.display = 'flex';
                        
                        iframeDesktop.src = this.activeUrl;
                        
                        iframeDesktop.onload = () => {
                           if(loaderDesktop) loaderDesktop.style.display = 'none';
                        };
                    }
                }
    };

    document.addEventListener("DOMContentLoaded", () => {
        maritimApp.init();
    });
</script>


</body>
</html>